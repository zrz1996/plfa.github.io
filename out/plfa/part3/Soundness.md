---
src       : "src/plfa/part3/Soundness.lagda.md"
title     : "Soundness: Soundness of reduction with respect to denotational semantics ğŸš§"
layout    : page
prev      : /Compositional/
permalink : /Soundness/
next      : /Adequacy/
---

{% raw %}<pre class="Agda"><a id="195" class="Keyword">module</a> <a id="202" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}" class="Module">plfa.part3.Soundness</a> <a id="223" class="Keyword">where</a>
</pre>{% endraw %}

## Introduction

In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L

    L â€”â†  Æ› N  implies  â„° L â‰ƒ â„° (Æ› N)

The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term `M` steps
to a term `N`, then `M` and `N` are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called _subject expansion_. It is also well-known that subject
expansion is false for most typed lambda calculi!


## Imports

{% raw %}<pre class="Agda"><a id="1087" class="Keyword">open</a> <a id="1092" class="Keyword">import</a> <a id="1099" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="1139" class="Keyword">using</a> <a id="1145" class="Symbol">(</a><a id="1146" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_â‰¡_</a><a id="1149" class="Symbol">;</a> <a id="1151" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">_â‰¢_</a><a id="1154" class="Symbol">;</a> <a id="1156" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="1160" class="Symbol">;</a> <a id="1162" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a><a id="1165" class="Symbol">;</a> <a id="1167" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#1090" class="Function">cong</a><a id="1171" class="Symbol">;</a> <a id="1173" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1436" class="Function">congâ‚‚</a><a id="1178" class="Symbol">;</a> <a id="1180" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.html#1308" class="Function">cong-app</a><a id="1188" class="Symbol">)</a>
<a id="1190" class="Keyword">open</a> <a id="1195" class="Keyword">import</a> <a id="1202" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html" class="Module">Data.Product</a> <a id="1215" class="Keyword">using</a> <a id="1221" class="Symbol">(</a><a id="1222" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">_Ã—_</a><a id="1225" class="Symbol">;</a> <a id="1227" href="Agda.Builtin.Sigma.html#139" class="Record">Î£</a><a id="1228" class="Symbol">;</a> <a id="1230" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Î£-syntax</a><a id="1238" class="Symbol">;</a> <a id="1240" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1364" class="Function">âˆƒ</a><a id="1241" class="Symbol">;</a> <a id="1243" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1783" class="Function">âˆƒ-syntax</a><a id="1251" class="Symbol">;</a> <a id="1253" href="Agda.Builtin.Sigma.html#225" class="Field">projâ‚</a><a id="1258" class="Symbol">;</a> <a id="1260" href="Agda.Builtin.Sigma.html#237" class="Field">projâ‚‚</a><a id="1265" class="Symbol">)</a>
  <a id="1269" class="Keyword">renaming</a> <a id="1278" class="Symbol">(</a><a id="1279" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">_,_</a> <a id="1283" class="Symbol">to</a> <a id="1286" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨_,_âŸ©</a><a id="1291" class="Symbol">)</a>
<a id="1293" class="Keyword">open</a> <a id="1298" class="Keyword">import</a> <a id="1305" href="Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="1320" class="Keyword">using</a> <a id="1326" class="Symbol">(</a><a id="1327" href="Agda.Primitive.html#611" class="Primitive">lzero</a><a id="1332" class="Symbol">)</a>
<a id="1334" class="Keyword">open</a> <a id="1339" class="Keyword">import</a> <a id="1346" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1363" class="Keyword">using</a> <a id="1369" class="Symbol">(</a><a id="1370" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#535" class="Function Operator">Â¬_</a><a id="1372" class="Symbol">)</a>
<a id="1374" class="Keyword">open</a> <a id="1379" class="Keyword">import</a> <a id="1386" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="1412" class="Keyword">using</a> <a id="1418" class="Symbol">(</a><a id="1419" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.Negation.html#809" class="Function">contradiction</a><a id="1432" class="Symbol">)</a>
<a id="1434" class="Keyword">open</a> <a id="1439" class="Keyword">import</a> <a id="1446" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html" class="Module">Data.Empty</a> <a id="1457" class="Keyword">using</a> <a id="1463" class="Symbol">(</a><a id="1464" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">âŠ¥-elim</a><a id="1470" class="Symbol">)</a>
<a id="1472" class="Keyword">open</a> <a id="1477" class="Keyword">import</a> <a id="1484" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1501" class="Keyword">using</a> <a id="1507" class="Symbol">(</a><a id="1508" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a><a id="1511" class="Symbol">;</a> <a id="1513" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a><a id="1516" class="Symbol">;</a> <a id="1518" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a><a id="1520" class="Symbol">)</a>
<a id="1522" class="Keyword">open</a> <a id="1527" class="Keyword">import</a> <a id="1534" href="https://agda.github.io/agda-stdlib/v1.1/Function.html" class="Module">Function</a> <a id="1543" class="Keyword">using</a> <a id="1549" class="Symbol">(</a><a id="1550" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">_âˆ˜_</a><a id="1553" class="Symbol">)</a>
<a id="1555" class="Keyword">open</a> <a id="1560" class="Keyword">import</a> <a id="1567" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}" class="Module">plfa.part2.Untyped</a>
     <a id="1591" class="Keyword">using</a> <a id="1597" class="Symbol">(</a><a id="1598" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3147" class="Datatype">Context</a><a id="1605" class="Symbol">;</a> <a id="1607" href="plfa.part2.Untyped.html#3185" class="InductiveConstructor Operator">_,_</a><a id="1610" class="Symbol">;</a> <a id="1612" href="plfa.part2.Untyped.html#3511" class="Datatype Operator">_âˆ‹_</a><a id="1615" class="Symbol">;</a> <a id="1617" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">_âŠ¢_</a><a id="1620" class="Symbol">;</a> <a id="1622" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="1623" class="Symbol">;</a> <a id="1625" href="plfa.part2.Untyped.html#3547" class="InductiveConstructor">Z</a><a id="1626" class="Symbol">;</a> <a id="1628" href="plfa.part2.Untyped.html#3592" class="InductiveConstructor Operator">S_</a><a id="1630" class="Symbol">;</a> <a id="1632" href="plfa.part2.Untyped.html#4316" class="InductiveConstructor Operator">`_</a><a id="1634" class="Symbol">;</a> <a id="1636" href="plfa.part2.Untyped.html#4368" class="InductiveConstructor Operator">Æ›_</a><a id="1638" class="Symbol">;</a> <a id="1640" href="plfa.part2.Untyped.html#4428" class="InductiveConstructor Operator">_Â·_</a><a id="1643" class="Symbol">;</a>
            <a id="1657" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6949" class="Function">subst</a><a id="1662" class="Symbol">;</a> <a id="1664" href="plfa.part2.Untyped.html#7477" class="Function Operator">_[_]</a><a id="1668" class="Symbol">;</a> <a id="1670" href="plfa.part2.Untyped.html#7361" class="Function">subst-zero</a><a id="1680" class="Symbol">;</a> <a id="1682" href="plfa.part2.Untyped.html#5911" class="Function">ext</a><a id="1685" class="Symbol">;</a> <a id="1687" href="plfa.part2.Untyped.html#6221" class="Function">rename</a><a id="1693" class="Symbol">;</a> <a id="1695" href="plfa.part2.Untyped.html#6657" class="Function">exts</a><a id="1699" class="Symbol">;</a>
            <a id="1713" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10133" class="Datatype Operator">_â€”â†’_</a><a id="1717" class="Symbol">;</a> <a id="1719" href="plfa.part2.Untyped.html#10183" class="InductiveConstructor">Î¾â‚</a><a id="1721" class="Symbol">;</a> <a id="1723" href="plfa.part2.Untyped.html#10273" class="InductiveConstructor">Î¾â‚‚</a><a id="1725" class="Symbol">;</a> <a id="1727" href="plfa.part2.Untyped.html#10363" class="InductiveConstructor">Î²</a><a id="1728" class="Symbol">;</a> <a id="1730" href="plfa.part2.Untyped.html#10471" class="InductiveConstructor">Î¶</a><a id="1731" class="Symbol">;</a> <a id="1733" href="plfa.part2.Untyped.html#11253" class="Datatype Operator">_â€”â† _</a><a id="1737" class="Symbol">;</a> <a id="1739" href="plfa.part2.Untyped.html#11359" class="InductiveConstructor Operator">_â€”â†’âŸ¨_âŸ©_</a><a id="1746" class="Symbol">;</a> <a id="1748" href="plfa.part2.Untyped.html#11303" class="InductiveConstructor Operator">_âˆ</a><a id="1750" class="Symbol">)</a>
<a id="1752" class="Keyword">open</a> <a id="1757" class="Keyword">import</a> <a id="1764" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}" class="Module">plfa.part2.Substitution</a> <a id="1788" class="Keyword">using</a> <a id="1794" class="Symbol">(</a><a id="1795" href="plfa.part2.Substitution.html#2192" class="Function">Rename</a><a id="1801" class="Symbol">;</a> <a id="1803" href="plfa.part2.Substitution.html#2405" class="Function">Subst</a><a id="1808" class="Symbol">;</a> <a id="1810" href="plfa.part2.Substitution.html#3046" class="Function">ids</a><a id="1813" class="Symbol">)</a>
<a id="1815" class="Keyword">open</a> <a id="1820" class="Keyword">import</a> <a id="1827" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}" class="Module">plfa.part3.Denotational</a>
     <a id="1856" class="Keyword">using</a> <a id="1862" class="Symbol">(</a><a id="1863" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#4070" class="Datatype">Value</a><a id="1868" class="Symbol">;</a> <a id="1870" href="plfa.part3.Denotational.html#4090" class="InductiveConstructor">âŠ¥</a><a id="1871" class="Symbol">;</a> <a id="1873" href="plfa.part3.Denotational.html#7207" class="Function">Env</a><a id="1876" class="Symbol">;</a> <a id="1878" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">_âŠ¢_â†“_</a><a id="1883" class="Symbol">;</a> <a id="1885" href="plfa.part3.Denotational.html#7364" class="Function Operator">_`,_</a><a id="1889" class="Symbol">;</a> <a id="1891" href="plfa.part3.Denotational.html#4427" class="Datatype Operator">_âŠ‘_</a><a id="1894" class="Symbol">;</a> <a id="1896" href="plfa.part3.Denotational.html#8179" class="Function Operator">_`âŠ‘_</a><a id="1900" class="Symbol">;</a> <a id="1902" href="plfa.part3.Denotational.html#8382" class="Function">`âŠ¥</a><a id="1904" class="Symbol">;</a> <a id="1906" href="plfa.part3.Denotational.html#8411" class="Function Operator">_`âŠ”_</a><a id="1910" class="Symbol">;</a> <a id="1912" href="plfa.part3.Denotational.html#7601" class="Function">init</a><a id="1916" class="Symbol">;</a> <a id="1918" href="plfa.part3.Denotational.html#7656" class="Function">last</a><a id="1922" class="Symbol">;</a> <a id="1924" href="plfa.part3.Denotational.html#7705" class="Function">init-last</a><a id="1933" class="Symbol">;</a>
            <a id="1947" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#5557" class="Function">âŠ‘-refl</a><a id="1953" class="Symbol">;</a> <a id="1955" href="plfa.part3.Denotational.html#4717" class="InductiveConstructor">âŠ‘-trans</a><a id="1962" class="Symbol">;</a> <a id="1964" href="plfa.part3.Denotational.html#8670" class="Function">`âŠ‘-refl</a><a id="1971" class="Symbol">;</a> <a id="1973" href="plfa.part3.Denotational.html#25866" class="Function">âŠ‘-env</a><a id="1978" class="Symbol">;</a> <a id="1980" href="plfa.part3.Denotational.html#8741" class="Function">âŠ‘-env-conj-R1</a><a id="1993" class="Symbol">;</a> <a id="1995" href="plfa.part3.Denotational.html#8847" class="Function">âŠ‘-env-conj-R2</a><a id="2008" class="Symbol">;</a> <a id="2010" href="plfa.part3.Denotational.html#26297" class="Function">up-env</a><a id="2016" class="Symbol">;</a>
            <a id="2030" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a><a id="2033" class="Symbol">;</a> <a id="2035" href="plfa.part3.Denotational.html#9546" class="InductiveConstructor">â†¦-elim</a><a id="2041" class="Symbol">;</a> <a id="2043" href="plfa.part3.Denotational.html#9668" class="InductiveConstructor">â†¦-intro</a><a id="2050" class="Symbol">;</a> <a id="2052" href="plfa.part3.Denotational.html#9780" class="InductiveConstructor">âŠ¥-intro</a><a id="2059" class="Symbol">;</a> <a id="2061" href="plfa.part3.Denotational.html#9847" class="InductiveConstructor">âŠ”-intro</a><a id="2068" class="Symbol">;</a> <a id="2070" href="plfa.part3.Denotational.html#9962" class="InductiveConstructor">sub</a><a id="2073" class="Symbol">;</a>
            <a id="2087" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#24274" class="Function">rename-pres</a><a id="2098" class="Symbol">;</a> <a id="2100" href="plfa.part3.Denotational.html#17516" class="Function">â„°</a><a id="2101" class="Symbol">;</a> <a id="2103" href="plfa.part3.Denotational.html#17698" class="Function Operator">_â‰ƒ_</a><a id="2106" class="Symbol">;</a> <a id="2108" href="plfa.part3.Denotational.html#18103" class="Function">â‰ƒ-trans</a><a id="2115" class="Symbol">)</a>
<a id="2117" class="Keyword">open</a> <a id="2122" class="Keyword">import</a> <a id="2129" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Compositional.md %}{% raw %}" class="Module">plfa.part3.Compositional</a> <a id="2154" class="Keyword">using</a> <a id="2160" class="Symbol">(</a><a id="2161" href="plfa.part3.Compositional.html#3841" class="Function">lambda-inversion</a><a id="2177" class="Symbol">;</a> <a id="2179" href="plfa.part3.Compositional.html#10031" class="Function">var-inv</a><a id="2186" class="Symbol">)</a>
</pre>{% endraw %}
## Forward reduction preserves denotations

The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.

The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.


### Simultaneous substitution preserves denotations

Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if `M` results in `v` in environment `Î³`, then applying a
substitution `Ïƒ` to `M` gives us a program that also results in `v`, but in
an environment `Î´` in which, for every variable `x`, `Ïƒ x` results in the
same value as the one for `x` in the original environment `Î³`.
We write `Î´ âŠ¢ Ïƒ â†“ Î³` for this condition.

{% raw %}<pre class="Agda"><a id="3181" class="Keyword">infix</a> <a id="3187" class="Number">3</a> <a id="3189" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3196" class="Function Operator">_`âŠ¢_â†“_</a>
<a id="_`âŠ¢_â†“_"></a><a id="3196" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3196" class="Function Operator">_`âŠ¢_â†“_</a> <a id="3203" class="Symbol">:</a> <a id="3205" class="Symbol">âˆ€{</a><a id="3207" href="plfa.part3.Soundness.html#3207" class="Bound">Î”</a> <a id="3209" href="plfa.part3.Soundness.html#3209" class="Bound">Î“</a><a id="3210" class="Symbol">}</a> <a id="3212" class="Symbol">â†’</a> <a id="3214" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="3218" href="plfa.part3.Soundness.html#3207" class="Bound">Î”</a> <a id="3220" class="Symbol">â†’</a> <a id="3222" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2405" class="Function">Subst</a> <a id="3228" href="plfa.part3.Soundness.html#3209" class="Bound">Î“</a> <a id="3230" href="plfa.part3.Soundness.html#3207" class="Bound">Î”</a> <a id="3232" class="Symbol">â†’</a> <a id="3234" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="3238" href="plfa.part3.Soundness.html#3209" class="Bound">Î“</a> <a id="3240" class="Symbol">â†’</a> <a id="3242" class="PrimitiveType">Set</a>
<a id="3246" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3196" class="Function Operator">_`âŠ¢_â†“_</a> <a id="3253" class="Symbol">{</a><a id="3254" href="plfa.part3.Soundness.html#3254" class="Bound">Î”</a><a id="3255" class="Symbol">}{</a><a id="3257" href="plfa.part3.Soundness.html#3257" class="Bound">Î“</a><a id="3258" class="Symbol">}</a> <a id="3260" href="plfa.part3.Soundness.html#3260" class="Bound">Î´</a> <a id="3262" href="plfa.part3.Soundness.html#3262" class="Bound">Ïƒ</a> <a id="3264" href="plfa.part3.Soundness.html#3264" class="Bound">Î³</a> <a id="3266" class="Symbol">=</a> <a id="3268" class="Symbol">(âˆ€</a> <a id="3271" class="Symbol">(</a><a id="3272" href="plfa.part3.Soundness.html#3272" class="Bound">x</a> <a id="3274" class="Symbol">:</a> <a id="3276" href="plfa.part3.Soundness.html#3257" class="Bound">Î“</a> <a id="3278" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3511" class="Datatype Operator">âˆ‹</a> <a id="3280" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="3281" class="Symbol">)</a> <a id="3283" class="Symbol">â†’</a> <a id="3285" href="plfa.part3.Soundness.html#3260" class="Bound">Î´</a> <a id="3287" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="3289" href="plfa.part3.Soundness.html#3262" class="Bound">Ïƒ</a> <a id="3291" href="plfa.part3.Soundness.html#3272" class="Bound">x</a> <a id="3293" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="3295" href="plfa.part3.Soundness.html#3264" class="Bound">Î³</a> <a id="3297" href="plfa.part3.Soundness.html#3272" class="Bound">x</a><a id="3298" class="Symbol">)</a>
</pre>{% endraw %}
As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the `exts` function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in `Î´ , v` produce the values in `Î³ , v`.

{% raw %}<pre class="Agda"><a id="subst-ext"></a><a id="3563" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3563" class="Function">subst-ext</a> <a id="3573" class="Symbol">:</a> <a id="3575" class="Symbol">âˆ€</a> <a id="3577" class="Symbol">{</a><a id="3578" href="plfa.part3.Soundness.html#3578" class="Bound">Î“</a> <a id="3580" href="plfa.part3.Soundness.html#3580" class="Bound">Î”</a> <a id="3582" href="plfa.part3.Soundness.html#3582" class="Bound">v</a><a id="3583" class="Symbol">}</a> <a id="3585" class="Symbol">{</a><a id="3586" href="plfa.part3.Soundness.html#3586" class="Bound">Î³</a> <a id="3588" class="Symbol">:</a> <a id="3590" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="3594" href="plfa.part3.Soundness.html#3578" class="Bound">Î“</a><a id="3595" class="Symbol">}</a> <a id="3597" class="Symbol">{</a><a id="3598" href="plfa.part3.Soundness.html#3598" class="Bound">Î´</a> <a id="3600" class="Symbol">:</a> <a id="3602" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="3606" href="plfa.part3.Soundness.html#3580" class="Bound">Î”</a><a id="3607" class="Symbol">}</a>
  <a id="3611" class="Symbol">â†’</a> <a id="3613" class="Symbol">(</a><a id="3614" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3614" class="Bound">Ïƒ</a> <a id="3616" class="Symbol">:</a> <a id="3618" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2405" class="Function">Subst</a> <a id="3624" href="plfa.part3.Soundness.html#3578" class="Bound">Î“</a> <a id="3626" href="plfa.part3.Soundness.html#3580" class="Bound">Î”</a><a id="3627" class="Symbol">)</a>
  <a id="3631" class="Symbol">â†’</a> <a id="3633" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3598" class="Bound">Î´</a> <a id="3635" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="3638" href="plfa.part3.Soundness.html#3614" class="Bound">Ïƒ</a> <a id="3640" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="3642" href="plfa.part3.Soundness.html#3586" class="Bound">Î³</a>
   <a id="3647" class="Comment">--------------------------</a>
  <a id="3676" class="Symbol">â†’</a> <a id="3678" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3598" class="Bound">Î´</a> <a id="3680" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7364" class="Function Operator">`,</a> <a id="3683" href="plfa.part3.Soundness.html#3582" class="Bound">v</a> <a id="3685" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="3688" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6657" class="Function">exts</a> <a id="3693" href="plfa.part3.Soundness.html#3614" class="Bound">Ïƒ</a> <a id="3695" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="3697" href="plfa.part3.Soundness.html#3586" class="Bound">Î³</a> <a id="3699" href="plfa.part3.Denotational.html#7364" class="Function Operator">`,</a> <a id="3702" href="plfa.part3.Soundness.html#3582" class="Bound">v</a>
<a id="3704" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3563" class="Function">subst-ext</a> <a id="3714" href="plfa.part3.Soundness.html#3714" class="Bound">Ïƒ</a> <a id="3716" href="plfa.part3.Soundness.html#3716" class="Bound">d</a> <a id="3718" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a> <a id="3720" class="Symbol">=</a> <a id="3722" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a>
<a id="3726" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#3563" class="Function">subst-ext</a> <a id="3736" href="plfa.part3.Soundness.html#3736" class="Bound">Ïƒ</a> <a id="3738" href="plfa.part3.Soundness.html#3738" class="Bound">d</a> <a id="3740" class="Symbol">(</a><a id="3741" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="3743" href="plfa.part3.Soundness.html#3743" class="Bound">xâ€²</a><a id="3745" class="Symbol">)</a> <a id="3747" class="Symbol">=</a> <a id="3749" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#24274" class="Function">rename-pres</a> <a id="3761" href="plfa.part2.Untyped.html#3592" class="InductiveConstructor Operator">S_</a> <a id="3764" class="Symbol">(Î»</a> <a id="3767" href="plfa.part3.Soundness.html#3767" class="Bound">_</a> <a id="3769" class="Symbol">â†’</a> <a id="3771" href="plfa.part3.Denotational.html#5557" class="Function">âŠ‘-refl</a><a id="3777" class="Symbol">)</a> <a id="3779" class="Symbol">(</a><a id="3780" href="plfa.part3.Soundness.html#3738" class="Bound">d</a> <a id="3782" href="plfa.part3.Soundness.html#3743" class="Bound">xâ€²</a><a id="3784" class="Symbol">)</a>
</pre>{% endraw %}
The proof is by cases on the de Bruijn index `x`.

* If it is `Z`, then we need to show that `Î´ , v âŠ¢ # 0 â†“ v`,
  which we have by rule `var`.

* If it is `S xâ€²`,then we need to show that
  `Î´ , v âŠ¢ rename S_ (Ïƒ xâ€²) â†“ nth xâ€² Î³`,
  which we obtain by the `rename-pres` lemma.

With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let's dive in!

{% raw %}<pre class="Agda"><a id="subst-pres"></a><a id="4201" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4212" class="Symbol">:</a> <a id="4214" class="Symbol">âˆ€</a> <a id="4216" class="Symbol">{</a><a id="4217" href="plfa.part3.Soundness.html#4217" class="Bound">Î“</a> <a id="4219" href="plfa.part3.Soundness.html#4219" class="Bound">Î”</a> <a id="4221" href="plfa.part3.Soundness.html#4221" class="Bound">v</a><a id="4222" class="Symbol">}</a> <a id="4224" class="Symbol">{</a><a id="4225" href="plfa.part3.Soundness.html#4225" class="Bound">Î³</a> <a id="4227" class="Symbol">:</a> <a id="4229" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="4233" href="plfa.part3.Soundness.html#4217" class="Bound">Î“</a><a id="4234" class="Symbol">}</a> <a id="4236" class="Symbol">{</a><a id="4237" href="plfa.part3.Soundness.html#4237" class="Bound">Î´</a> <a id="4239" class="Symbol">:</a> <a id="4241" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="4245" href="plfa.part3.Soundness.html#4219" class="Bound">Î”</a><a id="4246" class="Symbol">}</a> <a id="4248" class="Symbol">{</a><a id="4249" href="plfa.part3.Soundness.html#4249" class="Bound">M</a> <a id="4251" class="Symbol">:</a> <a id="4253" href="plfa.part3.Soundness.html#4217" class="Bound">Î“</a> <a id="4255" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4280" class="Datatype Operator">âŠ¢</a> <a id="4257" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="4258" class="Symbol">}</a>
  <a id="4262" class="Symbol">â†’</a> <a id="4264" class="Symbol">(</a><a id="4265" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4265" class="Bound">Ïƒ</a> <a id="4267" class="Symbol">:</a> <a id="4269" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2405" class="Function">Subst</a> <a id="4275" href="plfa.part3.Soundness.html#4217" class="Bound">Î“</a> <a id="4277" href="plfa.part3.Soundness.html#4219" class="Bound">Î”</a><a id="4278" class="Symbol">)</a>
  <a id="4282" class="Symbol">â†’</a> <a id="4284" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4237" class="Bound">Î´</a> <a id="4286" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="4289" href="plfa.part3.Soundness.html#4265" class="Bound">Ïƒ</a> <a id="4291" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="4293" href="plfa.part3.Soundness.html#4225" class="Bound">Î³</a>
  <a id="4297" class="Symbol">â†’</a> <a id="4299" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4225" class="Bound">Î³</a> <a id="4301" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="4303" href="plfa.part3.Soundness.html#4249" class="Bound">M</a> <a id="4305" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="4307" href="plfa.part3.Soundness.html#4221" class="Bound">v</a>
    <a id="4313" class="Comment">------------------</a>
  <a id="4334" class="Symbol">â†’</a> <a id="4336" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4237" class="Bound">Î´</a> <a id="4338" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="4340" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6949" class="Function">subst</a> <a id="4346" href="plfa.part3.Soundness.html#4265" class="Bound">Ïƒ</a> <a id="4348" href="plfa.part3.Soundness.html#4249" class="Bound">M</a> <a id="4350" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="4352" href="plfa.part3.Soundness.html#4221" class="Bound">v</a>
<a id="4354" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4365" href="plfa.part3.Soundness.html#4365" class="Bound">Ïƒ</a> <a id="4367" href="plfa.part3.Soundness.html#4367" class="Bound">s</a> <a id="4369" class="Symbol">(</a><a id="4370" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="4374" class="Symbol">{</a><a id="4375" class="Argument">x</a> <a id="4377" class="Symbol">=</a> <a id="4379" href="plfa.part3.Soundness.html#4379" class="Bound">x</a><a id="4380" class="Symbol">})</a> <a id="4383" class="Symbol">=</a> <a id="4385" class="Symbol">(</a><a id="4386" href="plfa.part3.Soundness.html#4367" class="Bound">s</a> <a id="4388" href="plfa.part3.Soundness.html#4379" class="Bound">x</a><a id="4389" class="Symbol">)</a>
<a id="4391" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4402" href="plfa.part3.Soundness.html#4402" class="Bound">Ïƒ</a> <a id="4404" href="plfa.part3.Soundness.html#4404" class="Bound">s</a> <a id="4406" class="Symbol">(</a><a id="4407" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="4414" href="plfa.part3.Soundness.html#4414" class="Bound">dâ‚</a> <a id="4417" href="plfa.part3.Soundness.html#4417" class="Bound">dâ‚‚</a><a id="4419" class="Symbol">)</a> <a id="4421" class="Symbol">=</a>
  <a id="4425" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="4432" class="Symbol">(</a><a id="4433" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4444" href="plfa.part3.Soundness.html#4402" class="Bound">Ïƒ</a> <a id="4446" href="plfa.part3.Soundness.html#4404" class="Bound">s</a> <a id="4448" href="plfa.part3.Soundness.html#4414" class="Bound">dâ‚</a><a id="4450" class="Symbol">)</a> <a id="4452" class="Symbol">(</a><a id="4453" href="plfa.part3.Soundness.html#4201" class="Function">subst-pres</a> <a id="4464" href="plfa.part3.Soundness.html#4402" class="Bound">Ïƒ</a> <a id="4466" href="plfa.part3.Soundness.html#4404" class="Bound">s</a> <a id="4468" href="plfa.part3.Soundness.html#4417" class="Bound">dâ‚‚</a><a id="4470" class="Symbol">)</a>
<a id="4472" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4483" href="plfa.part3.Soundness.html#4483" class="Bound">Ïƒ</a> <a id="4485" href="plfa.part3.Soundness.html#4485" class="Bound">s</a> <a id="4487" class="Symbol">(</a><a id="4488" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="4496" href="plfa.part3.Soundness.html#4496" class="Bound">d</a><a id="4497" class="Symbol">)</a> <a id="4499" class="Symbol">=</a>
  <a id="4503" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="4511" class="Symbol">(</a><a id="4512" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4523" class="Symbol">(Î»</a> <a id="4526" class="Symbol">{</a><a id="4527" href="plfa.part3.Soundness.html#4527" class="Bound">A</a><a id="4528" class="Symbol">}</a> <a id="4530" class="Symbol">â†’</a> <a id="4532" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6657" class="Function">exts</a> <a id="4537" href="plfa.part3.Soundness.html#4483" class="Bound">Ïƒ</a><a id="4538" class="Symbol">)</a> <a id="4540" class="Symbol">(</a><a id="4541" href="plfa.part3.Soundness.html#3563" class="Function">subst-ext</a> <a id="4551" href="plfa.part3.Soundness.html#4483" class="Bound">Ïƒ</a> <a id="4553" href="plfa.part3.Soundness.html#4485" class="Bound">s</a><a id="4554" class="Symbol">)</a> <a id="4556" href="plfa.part3.Soundness.html#4496" class="Bound">d</a><a id="4557" class="Symbol">)</a>
<a id="4559" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4570" href="plfa.part3.Soundness.html#4570" class="Bound">Ïƒ</a> <a id="4572" href="plfa.part3.Soundness.html#4572" class="Bound">s</a> <a id="4574" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a> <a id="4582" class="Symbol">=</a> <a id="4584" href="plfa.part3.Denotational.html#9780" class="InductiveConstructor">âŠ¥-intro</a>
<a id="4592" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4603" href="plfa.part3.Soundness.html#4603" class="Bound">Ïƒ</a> <a id="4605" href="plfa.part3.Soundness.html#4605" class="Bound">s</a> <a id="4607" class="Symbol">(</a><a id="4608" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="4616" href="plfa.part3.Soundness.html#4616" class="Bound">dâ‚</a> <a id="4619" href="plfa.part3.Soundness.html#4619" class="Bound">dâ‚‚</a><a id="4621" class="Symbol">)</a> <a id="4623" class="Symbol">=</a>
  <a id="4627" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="4635" class="Symbol">(</a><a id="4636" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4647" href="plfa.part3.Soundness.html#4603" class="Bound">Ïƒ</a> <a id="4649" href="plfa.part3.Soundness.html#4605" class="Bound">s</a> <a id="4651" href="plfa.part3.Soundness.html#4616" class="Bound">dâ‚</a><a id="4653" class="Symbol">)</a> <a id="4655" class="Symbol">(</a><a id="4656" href="plfa.part3.Soundness.html#4201" class="Function">subst-pres</a> <a id="4667" href="plfa.part3.Soundness.html#4603" class="Bound">Ïƒ</a> <a id="4669" href="plfa.part3.Soundness.html#4605" class="Bound">s</a> <a id="4671" href="plfa.part3.Soundness.html#4619" class="Bound">dâ‚‚</a><a id="4673" class="Symbol">)</a>
<a id="4675" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="4686" href="plfa.part3.Soundness.html#4686" class="Bound">Ïƒ</a> <a id="4688" href="plfa.part3.Soundness.html#4688" class="Bound">s</a> <a id="4690" class="Symbol">(</a><a id="4691" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="4695" href="plfa.part3.Soundness.html#4695" class="Bound">d</a> <a id="4697" href="plfa.part3.Soundness.html#4697" class="Bound">lt</a><a id="4699" class="Symbol">)</a> <a id="4701" class="Symbol">=</a> <a id="4703" href="plfa.part3.Denotational.html#9962" class="InductiveConstructor">sub</a> <a id="4707" class="Symbol">(</a><a id="4708" href="plfa.part3.Soundness.html#4201" class="Function">subst-pres</a> <a id="4719" href="plfa.part3.Soundness.html#4686" class="Bound">Ïƒ</a> <a id="4721" href="plfa.part3.Soundness.html#4688" class="Bound">s</a> <a id="4723" href="plfa.part3.Soundness.html#4695" class="Bound">d</a><a id="4724" class="Symbol">)</a> <a id="4726" href="plfa.part3.Soundness.html#4697" class="Bound">lt</a>
</pre>{% endraw %}
The proof is by induction on the semantics of `M`.  The two interesting
cases are for variables and lambda abstractions.

* For a variable `x`, we have that `v âŠ‘ nth x Î³` and we need to show that
  `Î´ âŠ¢ Ïƒ x â†“ v`.  From the premise applied to `x`, we have that
  `Î´ âŠ¢ Ïƒ x â†“ nth x Î³`, so we conclude by the `sub` rule.

* For a lambda abstraction, we must extend the substitution
  for the induction hypothesis. We apply the `subst-ext` lemma
  to show that the extended substitution maps variables to
  terms that result in the appropriate values.


### Single substitution preserves denotations

For Î² reduction, `(Æ› N) Â· M â€”â†’ N [ M ]`, we need to show that the
semantics is preserved when substituting `M` for de Bruijn index 0 in
term `N`. By inversion on the rules `â†¦-elim` and `â†¦-intro`,
we have that `Î³ , v âŠ¢ M â†“ w` and `Î³ âŠ¢ N â†“ v`.
So we need to show that `Î³ âŠ¢ M [ N ] â†“ w`, or equivalently,
that `Î³ âŠ¢ subst (subst-zero N) M â†“ w`.

{% raw %}<pre class="Agda"><a id="substitution"></a><a id="5676" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5676" class="Function">substitution</a> <a id="5689" class="Symbol">:</a> <a id="5691" class="Symbol">âˆ€</a> <a id="5693" class="Symbol">{</a><a id="5694" href="plfa.part3.Soundness.html#5694" class="Bound">Î“</a><a id="5695" class="Symbol">}</a> <a id="5697" class="Symbol">{</a><a id="5698" href="plfa.part3.Soundness.html#5698" class="Bound">Î³</a> <a id="5700" class="Symbol">:</a> <a id="5702" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="5706" href="plfa.part3.Soundness.html#5694" class="Bound">Î“</a><a id="5707" class="Symbol">}</a> <a id="5709" class="Symbol">{</a><a id="5710" href="plfa.part3.Soundness.html#5710" class="Bound">N</a> <a id="5712" href="plfa.part3.Soundness.html#5712" class="Bound">M</a> <a id="5714" href="plfa.part3.Soundness.html#5714" class="Bound">v</a> <a id="5716" href="plfa.part3.Soundness.html#5716" class="Bound">w</a><a id="5717" class="Symbol">}</a>
   <a id="5722" class="Symbol">â†’</a> <a id="5724" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5698" class="Bound">Î³</a> <a id="5726" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7364" class="Function Operator">`,</a> <a id="5729" href="plfa.part3.Soundness.html#5714" class="Bound">v</a> <a id="5731" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="5733" href="plfa.part3.Soundness.html#5710" class="Bound">N</a> <a id="5735" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="5737" href="plfa.part3.Soundness.html#5716" class="Bound">w</a>
   <a id="5742" class="Symbol">â†’</a> <a id="5744" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5698" class="Bound">Î³</a> <a id="5746" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="5748" href="plfa.part3.Soundness.html#5712" class="Bound">M</a> <a id="5750" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="5752" href="plfa.part3.Soundness.html#5714" class="Bound">v</a>
     <a id="5759" class="Comment">---------------</a>
   <a id="5778" class="Symbol">â†’</a> <a id="5780" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5698" class="Bound">Î³</a> <a id="5782" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="5784" href="plfa.part3.Soundness.html#5710" class="Bound">N</a> <a id="5786" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#7477" class="Function Operator">[</a> <a id="5788" href="plfa.part3.Soundness.html#5712" class="Bound">M</a> <a id="5790" href="plfa.part2.Untyped.html#7477" class="Function Operator">]</a> <a id="5792" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="5794" href="plfa.part3.Soundness.html#5716" class="Bound">w</a>
<a id="5796" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5676" class="Function">substitution</a><a id="5808" class="Symbol">{</a><a id="5809" href="plfa.part3.Soundness.html#5809" class="Bound">Î“</a><a id="5810" class="Symbol">}{</a><a id="5812" href="plfa.part3.Soundness.html#5812" class="Bound">Î³</a><a id="5813" class="Symbol">}{</a><a id="5815" href="plfa.part3.Soundness.html#5815" class="Bound">N</a><a id="5816" class="Symbol">}{</a><a id="5818" href="plfa.part3.Soundness.html#5818" class="Bound">M</a><a id="5819" class="Symbol">}{</a><a id="5821" href="plfa.part3.Soundness.html#5821" class="Bound">v</a><a id="5822" class="Symbol">}{</a><a id="5824" href="plfa.part3.Soundness.html#5824" class="Bound">w</a><a id="5825" class="Symbol">}</a> <a id="5827" href="plfa.part3.Soundness.html#5827" class="Bound">dn</a> <a id="5830" href="plfa.part3.Soundness.html#5830" class="Bound">dm</a> <a id="5833" class="Symbol">=</a>
  <a id="5837" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#4201" class="Function">subst-pres</a> <a id="5848" class="Symbol">(</a><a id="5849" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#7361" class="Function">subst-zero</a> <a id="5860" href="plfa.part3.Soundness.html#5818" class="Bound">M</a><a id="5861" class="Symbol">)</a> <a id="5863" href="plfa.part3.Soundness.html#5885" class="Function">sub-z-ok</a> <a id="5872" href="plfa.part3.Soundness.html#5827" class="Bound">dn</a>
  <a id="5877" class="Keyword">where</a>
  <a id="5885" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5885" class="Function">sub-z-ok</a> <a id="5894" class="Symbol">:</a> <a id="5896" href="plfa.part3.Soundness.html#5812" class="Bound">Î³</a> <a id="5898" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="5901" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#7361" class="Function">subst-zero</a> <a id="5912" href="plfa.part3.Soundness.html#5818" class="Bound">M</a> <a id="5914" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="5916" class="Symbol">(</a><a id="5917" href="plfa.part3.Soundness.html#5812" class="Bound">Î³</a> <a id="5919" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7364" class="Function Operator">`,</a> <a id="5922" href="plfa.part3.Soundness.html#5821" class="Bound">v</a><a id="5923" class="Symbol">)</a>
  <a id="5927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5885" class="Function">sub-z-ok</a> <a id="5936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a> <a id="5938" class="Symbol">=</a> <a id="5940" href="plfa.part3.Soundness.html#5830" class="Bound">dm</a>
  <a id="5945" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#5885" class="Function">sub-z-ok</a> <a id="5954" class="Symbol">(</a><a id="5955" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="5957" href="plfa.part3.Soundness.html#5957" class="Bound">x</a><a id="5958" class="Symbol">)</a> <a id="5960" class="Symbol">=</a> <a id="5962" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a>
</pre>{% endraw %}
This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that `subst-zero M` maps
variables to terms that produces the same values as those in `Î³ , v`.
Let `y` be an arbitrary variable (de Bruijn index).

* If it is `Z`, then `(subst-zero M) y = M` and `nth y (Î³ , v) = v`.
  By the premise we conclude that `Î³ âŠ¢ M â†“ v`.

* If it is `S x`, then `(subst-zero M) (S x) = x` and
  `nth (S x) (Î³ , v) = nth x Î³`.  So we conclude that
  `Î³ âŠ¢ x â†“ nth x Î³` by rule `var`.


### Reduction preserves denotations

With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.

{% raw %}<pre class="Agda"><a id="preserve"></a><a id="6639" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6648" class="Symbol">:</a> <a id="6650" class="Symbol">âˆ€</a> <a id="6652" class="Symbol">{</a><a id="6653" href="plfa.part3.Soundness.html#6653" class="Bound">Î“</a><a id="6654" class="Symbol">}</a> <a id="6656" class="Symbol">{</a><a id="6657" href="plfa.part3.Soundness.html#6657" class="Bound">Î³</a> <a id="6659" class="Symbol">:</a> <a id="6661" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="6665" href="plfa.part3.Soundness.html#6653" class="Bound">Î“</a><a id="6666" class="Symbol">}</a> <a id="6668" class="Symbol">{</a><a id="6669" href="plfa.part3.Soundness.html#6669" class="Bound">M</a> <a id="6671" href="plfa.part3.Soundness.html#6671" class="Bound">N</a> <a id="6673" href="plfa.part3.Soundness.html#6673" class="Bound">v</a><a id="6674" class="Symbol">}</a>
  <a id="6678" class="Symbol">â†’</a> <a id="6680" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6657" class="Bound">Î³</a> <a id="6682" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="6684" href="plfa.part3.Soundness.html#6669" class="Bound">M</a> <a id="6686" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="6688" href="plfa.part3.Soundness.html#6673" class="Bound">v</a>
  <a id="6692" class="Symbol">â†’</a> <a id="6694" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6669" class="Bound">M</a> <a id="6696" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10133" class="Datatype Operator">â€”â†’</a> <a id="6699" href="plfa.part3.Soundness.html#6671" class="Bound">N</a>
    <a id="6705" class="Comment">----------</a>
  <a id="6718" class="Symbol">â†’</a> <a id="6720" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6657" class="Bound">Î³</a> <a id="6722" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="6724" href="plfa.part3.Soundness.html#6671" class="Bound">N</a> <a id="6726" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="6728" href="plfa.part3.Soundness.html#6673" class="Bound">v</a>
<a id="6730" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6739" class="Symbol">(</a><a id="6740" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a><a id="6743" class="Symbol">)</a> <a id="6745" class="Symbol">()</a>
<a id="6748" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6757" class="Symbol">(</a><a id="6758" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="6765" href="plfa.part3.Soundness.html#6765" class="Bound">dâ‚</a> <a id="6768" href="plfa.part3.Soundness.html#6768" class="Bound">dâ‚‚</a><a id="6770" class="Symbol">)</a> <a id="6772" class="Symbol">(</a><a id="6773" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10183" class="InductiveConstructor">Î¾â‚</a> <a id="6776" href="plfa.part3.Soundness.html#6776" class="Bound">r</a><a id="6777" class="Symbol">)</a> <a id="6779" class="Symbol">=</a> <a id="6781" href="plfa.part3.Denotational.html#9546" class="InductiveConstructor">â†¦-elim</a> <a id="6788" class="Symbol">(</a><a id="6789" href="plfa.part3.Soundness.html#6639" class="Function">preserve</a> <a id="6798" href="plfa.part3.Soundness.html#6765" class="Bound">dâ‚</a> <a id="6801" href="plfa.part3.Soundness.html#6776" class="Bound">r</a><a id="6802" class="Symbol">)</a> <a id="6804" href="plfa.part3.Soundness.html#6768" class="Bound">dâ‚‚</a>
<a id="6807" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6816" class="Symbol">(</a><a id="6817" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="6824" href="plfa.part3.Soundness.html#6824" class="Bound">dâ‚</a> <a id="6827" href="plfa.part3.Soundness.html#6827" class="Bound">dâ‚‚</a><a id="6829" class="Symbol">)</a> <a id="6831" class="Symbol">(</a><a id="6832" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10273" class="InductiveConstructor">Î¾â‚‚</a> <a id="6835" href="plfa.part3.Soundness.html#6835" class="Bound">r</a><a id="6836" class="Symbol">)</a> <a id="6838" class="Symbol">=</a> <a id="6840" href="plfa.part3.Denotational.html#9546" class="InductiveConstructor">â†¦-elim</a> <a id="6847" href="plfa.part3.Soundness.html#6824" class="Bound">dâ‚</a> <a id="6850" class="Symbol">(</a><a id="6851" href="plfa.part3.Soundness.html#6639" class="Function">preserve</a> <a id="6860" href="plfa.part3.Soundness.html#6827" class="Bound">dâ‚‚</a> <a id="6863" href="plfa.part3.Soundness.html#6835" class="Bound">r</a><a id="6864" class="Symbol">)</a>
<a id="6866" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6875" class="Symbol">(</a><a id="6876" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="6883" href="plfa.part3.Soundness.html#6883" class="Bound">dâ‚</a> <a id="6886" href="plfa.part3.Soundness.html#6886" class="Bound">dâ‚‚</a><a id="6888" class="Symbol">)</a> <a id="6890" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10363" class="InductiveConstructor">Î²</a> <a id="6892" class="Symbol">=</a> <a id="6894" href="plfa.part3.Soundness.html#5676" class="Function">substitution</a> <a id="6907" class="Symbol">(</a><a id="6908" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Compositional.md %}{% raw %}#3841" class="Function">lambda-inversion</a> <a id="6925" href="plfa.part3.Soundness.html#6883" class="Bound">dâ‚</a><a id="6927" class="Symbol">)</a> <a id="6929" href="plfa.part3.Soundness.html#6886" class="Bound">dâ‚‚</a>
<a id="6932" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6941" class="Symbol">(</a><a id="6942" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="6950" href="plfa.part3.Soundness.html#6950" class="Bound">d</a><a id="6951" class="Symbol">)</a> <a id="6953" class="Symbol">(</a><a id="6954" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10471" class="InductiveConstructor">Î¶</a> <a id="6956" href="plfa.part3.Soundness.html#6956" class="Bound">r</a><a id="6957" class="Symbol">)</a> <a id="6959" class="Symbol">=</a> <a id="6961" href="plfa.part3.Denotational.html#9668" class="InductiveConstructor">â†¦-intro</a> <a id="6969" class="Symbol">(</a><a id="6970" href="plfa.part3.Soundness.html#6639" class="Function">preserve</a> <a id="6979" href="plfa.part3.Soundness.html#6950" class="Bound">d</a> <a id="6981" href="plfa.part3.Soundness.html#6956" class="Bound">r</a><a id="6982" class="Symbol">)</a>
<a id="6984" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="6993" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a> <a id="7001" href="plfa.part3.Soundness.html#7001" class="Bound">r</a> <a id="7003" class="Symbol">=</a> <a id="7005" href="plfa.part3.Denotational.html#9780" class="InductiveConstructor">âŠ¥-intro</a>
<a id="7013" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="7022" class="Symbol">(</a><a id="7023" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="7031" href="plfa.part3.Soundness.html#7031" class="Bound">d</a> <a id="7033" href="plfa.part3.Soundness.html#7033" class="Bound">dâ‚</a><a id="7035" class="Symbol">)</a> <a id="7037" href="plfa.part3.Soundness.html#7037" class="Bound">r</a> <a id="7039" class="Symbol">=</a> <a id="7041" href="plfa.part3.Denotational.html#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="7049" class="Symbol">(</a><a id="7050" href="plfa.part3.Soundness.html#6639" class="Function">preserve</a> <a id="7059" href="plfa.part3.Soundness.html#7031" class="Bound">d</a> <a id="7061" href="plfa.part3.Soundness.html#7037" class="Bound">r</a><a id="7062" class="Symbol">)</a> <a id="7064" class="Symbol">(</a><a id="7065" href="plfa.part3.Soundness.html#6639" class="Function">preserve</a> <a id="7074" href="plfa.part3.Soundness.html#7033" class="Bound">dâ‚</a> <a id="7077" href="plfa.part3.Soundness.html#7037" class="Bound">r</a><a id="7078" class="Symbol">)</a>
<a id="7080" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#6639" class="Function">preserve</a> <a id="7089" class="Symbol">(</a><a id="7090" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="7094" href="plfa.part3.Soundness.html#7094" class="Bound">d</a> <a id="7096" href="plfa.part3.Soundness.html#7096" class="Bound">lt</a><a id="7098" class="Symbol">)</a> <a id="7100" href="plfa.part3.Soundness.html#7100" class="Bound">r</a> <a id="7102" class="Symbol">=</a> <a id="7104" href="plfa.part3.Denotational.html#9962" class="InductiveConstructor">sub</a> <a id="7108" class="Symbol">(</a><a id="7109" href="plfa.part3.Soundness.html#6639" class="Function">preserve</a> <a id="7118" href="plfa.part3.Soundness.html#7094" class="Bound">d</a> <a id="7120" href="plfa.part3.Soundness.html#7100" class="Bound">r</a><a id="7121" class="Symbol">)</a> <a id="7123" href="plfa.part3.Soundness.html#7096" class="Bound">lt</a>
</pre>{% endraw %}
We proceed by induction on the semantics of `M` with case analysis on
the reduction.

* If `M` is a variable, then there is no such reduction.

* If `M` is an application, then the reduction is either a congruence
  (Î¾â‚ or Î¾â‚‚) or Î². For each congruence, we use the induction
  hypothesis. For Î² reduction we use the substitution lemma and the
  `sub` rule.

* The rest of the cases are straightforward.

## Reduction reflects denotations

This section proves that reduction reflects the denotation of a
term. That is, if `N` results in `v`, and if `M` reduces to `N`, then
`M` also results in `v`. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.

The main challenge is dealing with the substitution in Î² reduction:

    (Æ› N) Â· M â€”â†’ N [ M ]

We have that `Î³ âŠ¢ N [ M ] â†“ v` and need to show that
`Î³ âŠ¢ (Æ› N) Â· M â†“ v`. Now consider the derivation of `Î³ âŠ¢ N [ M ] â†“ v`.
The term `M` may occur 0, 1, or many times inside `N [ M ]`. At each of
those occurences, `M` may result in a different value. But to build a
derivation for `(Æ› N) Â· M`, we need a single value for `M`.  If `M`
occured more than 1 time, then we can join all of the different values
using `âŠ”`. If `M` occured 0 times, then we do not need any information
about `M` and can therefore use `âŠ¥` for the value of `M`.


### Renaming reflects meaning

Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if `Î´ âŠ¢ rename Ï M â†“ v`, then `Î³ âŠ¢ M â†“ v`, where `(Î´ âˆ˜ Ï) `âŠ‘ Î³`.

First, we need a variant of a lemma given earlier.
{% raw %}<pre class="Agda"><a id="nth-ext"></a><a id="8813" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#8813" class="Function">nth-ext</a> <a id="8821" class="Symbol">:</a> <a id="8823" class="Symbol">âˆ€</a> <a id="8825" class="Symbol">{</a><a id="8826" href="plfa.part3.Soundness.html#8826" class="Bound">Î“</a> <a id="8828" href="plfa.part3.Soundness.html#8828" class="Bound">Î”</a> <a id="8830" href="plfa.part3.Soundness.html#8830" class="Bound">v</a><a id="8831" class="Symbol">}</a> <a id="8833" class="Symbol">{</a><a id="8834" href="plfa.part3.Soundness.html#8834" class="Bound">Î³</a> <a id="8836" class="Symbol">:</a> <a id="8838" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="8842" href="plfa.part3.Soundness.html#8826" class="Bound">Î“</a><a id="8843" class="Symbol">}</a> <a id="8845" class="Symbol">{</a><a id="8846" href="plfa.part3.Soundness.html#8846" class="Bound">Î´</a> <a id="8848" class="Symbol">:</a> <a id="8850" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="8854" href="plfa.part3.Soundness.html#8828" class="Bound">Î”</a><a id="8855" class="Symbol">}</a>
  <a id="8859" class="Symbol">â†’</a> <a id="8861" class="Symbol">(</a><a id="8862" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#8862" class="Bound">Ï</a> <a id="8864" class="Symbol">:</a> <a id="8866" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2192" class="Function">Rename</a> <a id="8873" href="plfa.part3.Soundness.html#8826" class="Bound">Î“</a> <a id="8875" href="plfa.part3.Soundness.html#8828" class="Bound">Î”</a><a id="8876" class="Symbol">)</a>
  <a id="8880" class="Symbol">â†’</a> <a id="8882" class="Symbol">(</a><a id="8883" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#8846" class="Bound">Î´</a> <a id="8885" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">âˆ˜</a> <a id="8887" href="plfa.part3.Soundness.html#8862" class="Bound">Ï</a><a id="8888" class="Symbol">)</a> <a id="8890" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8179" class="Function Operator">`âŠ‘</a> <a id="8893" href="plfa.part3.Soundness.html#8834" class="Bound">Î³</a>
    <a id="8899" class="Comment">------------------------------</a>
  <a id="8932" class="Symbol">â†’</a> <a id="8934" class="Symbol">((</a><a id="8936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#8846" class="Bound">Î´</a> <a id="8938" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7364" class="Function Operator">`,</a> <a id="8941" href="plfa.part3.Soundness.html#8830" class="Bound">v</a><a id="8942" class="Symbol">)</a> <a id="8944" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">âˆ˜</a> <a id="8946" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#5911" class="Function">ext</a> <a id="8950" href="plfa.part3.Soundness.html#8862" class="Bound">Ï</a><a id="8951" class="Symbol">)</a> <a id="8953" href="plfa.part3.Denotational.html#8179" class="Function Operator">`âŠ‘</a> <a id="8956" class="Symbol">(</a><a id="8957" href="plfa.part3.Soundness.html#8834" class="Bound">Î³</a> <a id="8959" href="plfa.part3.Denotational.html#7364" class="Function Operator">`,</a> <a id="8962" href="plfa.part3.Soundness.html#8830" class="Bound">v</a><a id="8963" class="Symbol">)</a>
<a id="8965" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#8813" class="Function">nth-ext</a> <a id="8973" href="plfa.part3.Soundness.html#8973" class="Bound">Ï</a> <a id="8975" href="plfa.part3.Soundness.html#8975" class="Bound">lt</a> <a id="8978" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a> <a id="8980" class="Symbol">=</a> <a id="8982" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#5557" class="Function">âŠ‘-refl</a>
<a id="8989" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#8813" class="Function">nth-ext</a> <a id="8997" href="plfa.part3.Soundness.html#8997" class="Bound">Ï</a> <a id="8999" href="plfa.part3.Soundness.html#8999" class="Bound">lt</a> <a id="9002" class="Symbol">(</a><a id="9003" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="9005" href="plfa.part3.Soundness.html#9005" class="Bound">x</a><a id="9006" class="Symbol">)</a> <a id="9008" class="Symbol">=</a> <a id="9010" href="plfa.part3.Soundness.html#8999" class="Bound">lt</a> <a id="9013" href="plfa.part3.Soundness.html#9005" class="Bound">x</a>
</pre>{% endraw %}
The proof is then as follows.
{% raw %}<pre class="Agda"><a id="rename-reflect"></a><a id="9054" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9069" class="Symbol">:</a> <a id="9071" class="Symbol">âˆ€</a> <a id="9073" class="Symbol">{</a><a id="9074" href="plfa.part3.Soundness.html#9074" class="Bound">Î“</a> <a id="9076" href="plfa.part3.Soundness.html#9076" class="Bound">Î”</a> <a id="9078" href="plfa.part3.Soundness.html#9078" class="Bound">v</a><a id="9079" class="Symbol">}</a> <a id="9081" class="Symbol">{</a><a id="9082" href="plfa.part3.Soundness.html#9082" class="Bound">Î³</a> <a id="9084" class="Symbol">:</a> <a id="9086" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="9090" href="plfa.part3.Soundness.html#9074" class="Bound">Î“</a><a id="9091" class="Symbol">}</a> <a id="9093" class="Symbol">{</a><a id="9094" href="plfa.part3.Soundness.html#9094" class="Bound">Î´</a> <a id="9096" class="Symbol">:</a> <a id="9098" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="9102" href="plfa.part3.Soundness.html#9076" class="Bound">Î”</a><a id="9103" class="Symbol">}</a> <a id="9105" class="Symbol">{</a> <a id="9107" href="plfa.part3.Soundness.html#9107" class="Bound">M</a> <a id="9109" class="Symbol">:</a> <a id="9111" href="plfa.part3.Soundness.html#9074" class="Bound">Î“</a> <a id="9113" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4280" class="Datatype Operator">âŠ¢</a> <a id="9115" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="9116" class="Symbol">}</a>
  <a id="9120" class="Symbol">â†’</a> <a id="9122" class="Symbol">{</a><a id="9123" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9123" class="Bound">Ï</a> <a id="9125" class="Symbol">:</a> <a id="9127" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2192" class="Function">Rename</a> <a id="9134" href="plfa.part3.Soundness.html#9074" class="Bound">Î“</a> <a id="9136" href="plfa.part3.Soundness.html#9076" class="Bound">Î”</a><a id="9137" class="Symbol">}</a>
  <a id="9141" class="Symbol">â†’</a> <a id="9143" class="Symbol">(</a><a id="9144" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9094" class="Bound">Î´</a> <a id="9146" href="https://agda.github.io/agda-stdlib/v1.1/Function.html#1099" class="Function Operator">âˆ˜</a> <a id="9148" href="plfa.part3.Soundness.html#9123" class="Bound">Ï</a><a id="9149" class="Symbol">)</a> <a id="9151" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8179" class="Function Operator">`âŠ‘</a> <a id="9154" href="plfa.part3.Soundness.html#9082" class="Bound">Î³</a>
  <a id="9158" class="Symbol">â†’</a> <a id="9160" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9094" class="Bound">Î´</a> <a id="9162" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="9164" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6221" class="Function">rename</a> <a id="9171" href="plfa.part3.Soundness.html#9123" class="Bound">Ï</a> <a id="9173" href="plfa.part3.Soundness.html#9107" class="Bound">M</a> <a id="9175" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="9177" href="plfa.part3.Soundness.html#9078" class="Bound">v</a>
    <a id="9183" class="Comment">------------------------------------</a>
  <a id="9222" class="Symbol">â†’</a> <a id="9224" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9082" class="Bound">Î³</a> <a id="9226" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="9228" href="plfa.part3.Soundness.html#9107" class="Bound">M</a> <a id="9230" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="9232" href="plfa.part3.Soundness.html#9078" class="Bound">v</a>
<a id="9234" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9249" class="Symbol">{</a><a id="9250" class="Argument">M</a> <a id="9252" class="Symbol">=</a> <a id="9254" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4316" class="InductiveConstructor Operator">`</a> <a id="9256" href="plfa.part3.Soundness.html#9256" class="Bound">x</a><a id="9257" class="Symbol">}</a> <a id="9259" href="plfa.part3.Soundness.html#9259" class="Bound">all-n</a> <a id="9265" href="plfa.part3.Soundness.html#9265" class="Bound">d</a> <a id="9267" class="Keyword">with</a> <a id="9272" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Compositional.md %}{% raw %}#10031" class="Function">var-inv</a> <a id="9280" href="plfa.part3.Soundness.html#9265" class="Bound">d</a>
<a id="9282" class="Symbol">...</a> <a id="9286" class="Symbol">|</a> <a id="9288" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9288" class="Bound">lt</a> <a id="9291" class="Symbol">=</a>  <a id="9294" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="9298" href="plfa.part3.Denotational.html#9471" class="InductiveConstructor">var</a> <a id="9302" class="Symbol">(</a><a id="9303" href="plfa.part3.Denotational.html#4717" class="InductiveConstructor">âŠ‘-trans</a> <a id="9311" href="plfa.part3.Soundness.html#9288" class="Bound">lt</a> <a id="9314" class="Symbol">(</a><a id="9315" class="Bound">all-n</a> <a id="9321" class="Bound">x</a><a id="9322" class="Symbol">))</a>
<a id="9325" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9340" class="Symbol">{</a><a id="9341" class="Argument">M</a> <a id="9343" class="Symbol">=</a> <a id="9345" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="9347" href="plfa.part3.Soundness.html#9347" class="Bound">N</a><a id="9348" class="Symbol">}{</a><a id="9350" class="Argument">Ï</a> <a id="9352" class="Symbol">=</a> <a id="9354" href="plfa.part3.Soundness.html#9354" class="Bound">Ï</a><a id="9355" class="Symbol">}</a> <a id="9357" href="plfa.part3.Soundness.html#9357" class="Bound">all-n</a> <a id="9363" class="Symbol">(</a><a id="9364" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="9372" href="plfa.part3.Soundness.html#9372" class="Bound">d</a><a id="9373" class="Symbol">)</a> <a id="9375" class="Symbol">=</a>
   <a id="9380" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="9388" class="Symbol">(</a><a id="9389" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9404" class="Symbol">(</a><a id="9405" href="plfa.part3.Soundness.html#8813" class="Function">nth-ext</a> <a id="9413" href="plfa.part3.Soundness.html#9354" class="Bound">Ï</a> <a id="9415" href="plfa.part3.Soundness.html#9357" class="Bound">all-n</a><a id="9420" class="Symbol">)</a> <a id="9422" href="plfa.part3.Soundness.html#9372" class="Bound">d</a><a id="9423" class="Symbol">)</a>
<a id="9425" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9440" class="Symbol">{</a><a id="9441" class="Argument">M</a> <a id="9443" class="Symbol">=</a> <a id="9445" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="9447" href="plfa.part3.Soundness.html#9447" class="Bound">N</a><a id="9448" class="Symbol">}</a> <a id="9450" href="plfa.part3.Soundness.html#9450" class="Bound">all-n</a> <a id="9456" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a> <a id="9464" class="Symbol">=</a> <a id="9466" href="plfa.part3.Denotational.html#9780" class="InductiveConstructor">âŠ¥-intro</a>
<a id="9474" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9489" class="Symbol">{</a><a id="9490" class="Argument">M</a> <a id="9492" class="Symbol">=</a> <a id="9494" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="9496" href="plfa.part3.Soundness.html#9496" class="Bound">N</a><a id="9497" class="Symbol">}</a> <a id="9499" href="plfa.part3.Soundness.html#9499" class="Bound">all-n</a> <a id="9505" class="Symbol">(</a><a id="9506" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="9514" href="plfa.part3.Soundness.html#9514" class="Bound">dâ‚</a> <a id="9517" href="plfa.part3.Soundness.html#9517" class="Bound">dâ‚‚</a><a id="9519" class="Symbol">)</a> <a id="9521" class="Symbol">=</a>
   <a id="9526" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="9534" class="Symbol">(</a><a id="9535" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9550" href="plfa.part3.Soundness.html#9499" class="Bound">all-n</a> <a id="9556" href="plfa.part3.Soundness.html#9514" class="Bound">dâ‚</a><a id="9558" class="Symbol">)</a> <a id="9560" class="Symbol">(</a><a id="9561" href="plfa.part3.Soundness.html#9054" class="Function">rename-reflect</a> <a id="9576" href="plfa.part3.Soundness.html#9499" class="Bound">all-n</a> <a id="9582" href="plfa.part3.Soundness.html#9517" class="Bound">dâ‚‚</a><a id="9584" class="Symbol">)</a>
<a id="9586" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9601" class="Symbol">{</a><a id="9602" class="Argument">M</a> <a id="9604" class="Symbol">=</a> <a id="9606" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="9608" href="plfa.part3.Soundness.html#9608" class="Bound">N</a><a id="9609" class="Symbol">}</a> <a id="9611" href="plfa.part3.Soundness.html#9611" class="Bound">all-n</a> <a id="9617" class="Symbol">(</a><a id="9618" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="9622" href="plfa.part3.Soundness.html#9622" class="Bound">dâ‚</a> <a id="9625" href="plfa.part3.Soundness.html#9625" class="Bound">lt</a><a id="9627" class="Symbol">)</a> <a id="9629" class="Symbol">=</a>
   <a id="9634" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="9638" class="Symbol">(</a><a id="9639" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9654" href="plfa.part3.Soundness.html#9611" class="Bound">all-n</a> <a id="9660" href="plfa.part3.Soundness.html#9622" class="Bound">dâ‚</a><a id="9662" class="Symbol">)</a> <a id="9664" href="plfa.part3.Soundness.html#9625" class="Bound">lt</a>
<a id="9667" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9682" class="Symbol">{</a><a id="9683" class="Argument">M</a> <a id="9685" class="Symbol">=</a> <a id="9687" href="plfa.part3.Soundness.html#9687" class="Bound">L</a> <a id="9689" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4428" class="InductiveConstructor Operator">Â·</a> <a id="9691" href="plfa.part3.Soundness.html#9691" class="Bound">M</a><a id="9692" class="Symbol">}</a> <a id="9694" href="plfa.part3.Soundness.html#9694" class="Bound">all-n</a> <a id="9700" class="Symbol">(</a><a id="9701" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="9708" href="plfa.part3.Soundness.html#9708" class="Bound">dâ‚</a> <a id="9711" href="plfa.part3.Soundness.html#9711" class="Bound">dâ‚‚</a><a id="9713" class="Symbol">)</a> <a id="9715" class="Symbol">=</a>
   <a id="9720" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="9727" class="Symbol">(</a><a id="9728" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9743" href="plfa.part3.Soundness.html#9694" class="Bound">all-n</a> <a id="9749" href="plfa.part3.Soundness.html#9708" class="Bound">dâ‚</a><a id="9751" class="Symbol">)</a> <a id="9753" class="Symbol">(</a><a id="9754" href="plfa.part3.Soundness.html#9054" class="Function">rename-reflect</a> <a id="9769" href="plfa.part3.Soundness.html#9694" class="Bound">all-n</a> <a id="9775" href="plfa.part3.Soundness.html#9711" class="Bound">dâ‚‚</a><a id="9777" class="Symbol">)</a>
<a id="9779" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9794" class="Symbol">{</a><a id="9795" class="Argument">M</a> <a id="9797" class="Symbol">=</a> <a id="9799" href="plfa.part3.Soundness.html#9799" class="Bound">L</a> <a id="9801" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4428" class="InductiveConstructor Operator">Â·</a> <a id="9803" href="plfa.part3.Soundness.html#9803" class="Bound">M</a><a id="9804" class="Symbol">}</a> <a id="9806" href="plfa.part3.Soundness.html#9806" class="Bound">all-n</a> <a id="9812" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a> <a id="9820" class="Symbol">=</a> <a id="9822" href="plfa.part3.Denotational.html#9780" class="InductiveConstructor">âŠ¥-intro</a>
<a id="9830" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9845" class="Symbol">{</a><a id="9846" class="Argument">M</a> <a id="9848" class="Symbol">=</a> <a id="9850" href="plfa.part3.Soundness.html#9850" class="Bound">L</a> <a id="9852" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4428" class="InductiveConstructor Operator">Â·</a> <a id="9854" href="plfa.part3.Soundness.html#9854" class="Bound">M</a><a id="9855" class="Symbol">}</a> <a id="9857" href="plfa.part3.Soundness.html#9857" class="Bound">all-n</a> <a id="9863" class="Symbol">(</a><a id="9864" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="9872" href="plfa.part3.Soundness.html#9872" class="Bound">dâ‚</a> <a id="9875" href="plfa.part3.Soundness.html#9875" class="Bound">dâ‚‚</a><a id="9877" class="Symbol">)</a> <a id="9879" class="Symbol">=</a>
   <a id="9884" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="9892" class="Symbol">(</a><a id="9893" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9908" href="plfa.part3.Soundness.html#9857" class="Bound">all-n</a> <a id="9914" href="plfa.part3.Soundness.html#9872" class="Bound">dâ‚</a><a id="9916" class="Symbol">)</a> <a id="9918" class="Symbol">(</a><a id="9919" href="plfa.part3.Soundness.html#9054" class="Function">rename-reflect</a> <a id="9934" href="plfa.part3.Soundness.html#9857" class="Bound">all-n</a> <a id="9940" href="plfa.part3.Soundness.html#9875" class="Bound">dâ‚‚</a><a id="9942" class="Symbol">)</a>
<a id="9944" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="9959" class="Symbol">{</a><a id="9960" class="Argument">M</a> <a id="9962" class="Symbol">=</a> <a id="9964" href="plfa.part3.Soundness.html#9964" class="Bound">L</a> <a id="9966" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4428" class="InductiveConstructor Operator">Â·</a> <a id="9968" href="plfa.part3.Soundness.html#9968" class="Bound">M</a><a id="9969" class="Symbol">}</a> <a id="9971" href="plfa.part3.Soundness.html#9971" class="Bound">all-n</a> <a id="9977" class="Symbol">(</a><a id="9978" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="9982" href="plfa.part3.Soundness.html#9982" class="Bound">dâ‚</a> <a id="9985" href="plfa.part3.Soundness.html#9985" class="Bound">lt</a><a id="9987" class="Symbol">)</a> <a id="9989" class="Symbol">=</a>
   <a id="9994" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="9998" class="Symbol">(</a><a id="9999" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#9054" class="Function">rename-reflect</a> <a id="10014" href="plfa.part3.Soundness.html#9971" class="Bound">all-n</a> <a id="10020" href="plfa.part3.Soundness.html#9982" class="Bound">dâ‚</a><a id="10022" class="Symbol">)</a> <a id="10024" href="plfa.part3.Soundness.html#9985" class="Bound">lt</a>
</pre>{% endraw %}
We cannot prove this lemma by induction on the derivation of
`Î´ âŠ¢ rename Ï M â†“ v`, so instead we proceed by induction on `M`.

* If it is a variable, we apply the inversion lemma to obtain
  that `v âŠ‘ nth (Ï x) Î´`. Instantiating the premise to `x` we have
  `nth (Ï x) Î´ = nth x Î³`, so we conclude by the `var` rule.

* If it is a lambda abstraction `Æ› N`, we have
  rename `Ï (Æ› N) = Æ› (rename (ext Ï) N)`.
  We proceed by cases on `Î´ âŠ¢ Æ› (rename (ext Ï) N) â†“ v`.

  * Rule `â†¦-intro`: To satisfy the premise of the induction
    hypothesis, we prove that the renaming can be extended to be a
    mapping from `Î³ , vâ‚ to Î´ , vâ‚`.

  * Rule `âŠ¥-intro`: We simply apply `âŠ¥-intro`.

  * Rule `âŠ”-intro`: We apply the induction hypotheses and `âŠ”-intro`.

  * Rule `sub`: We apply the induction hypothesis and `sub`.

* If it is an application `L Â· M`, we have
  `rename Ï (L Â· M) = (rename Ï L) Â· (rename Ï M)`.
  We proceed by cases on `Î´ âŠ¢ (rename Ï L) Â· (rename Ï M) â†“ v`
  and all the cases are straightforward.

In the upcoming uses of `rename-reflect`, the renaming will always be
the increment function. So we prove a corollary for that special case.

{% raw %}<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11189" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#11189" class="Function">rename-inc-reflect</a> <a id="11208" class="Symbol">:</a> <a id="11210" class="Symbol">âˆ€</a> <a id="11212" class="Symbol">{</a><a id="11213" href="plfa.part3.Soundness.html#11213" class="Bound">Î“</a> <a id="11215" href="plfa.part3.Soundness.html#11215" class="Bound">vâ€²</a> <a id="11218" href="plfa.part3.Soundness.html#11218" class="Bound">v</a><a id="11219" class="Symbol">}</a> <a id="11221" class="Symbol">{</a><a id="11222" href="plfa.part3.Soundness.html#11222" class="Bound">Î³</a> <a id="11224" class="Symbol">:</a> <a id="11226" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="11230" href="plfa.part3.Soundness.html#11213" class="Bound">Î“</a><a id="11231" class="Symbol">}</a> <a id="11233" class="Symbol">{</a> <a id="11235" href="plfa.part3.Soundness.html#11235" class="Bound">M</a> <a id="11237" class="Symbol">:</a> <a id="11239" href="plfa.part3.Soundness.html#11213" class="Bound">Î“</a> <a id="11241" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4280" class="Datatype Operator">âŠ¢</a> <a id="11243" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="11244" class="Symbol">}</a>
  <a id="11248" class="Symbol">â†’</a> <a id="11250" class="Symbol">(</a><a id="11251" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#11222" class="Bound">Î³</a> <a id="11253" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7364" class="Function Operator">`,</a> <a id="11256" href="plfa.part3.Soundness.html#11215" class="Bound">vâ€²</a><a id="11258" class="Symbol">)</a> <a id="11260" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="11262" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6221" class="Function">rename</a> <a id="11269" href="plfa.part2.Untyped.html#3592" class="InductiveConstructor Operator">S_</a> <a id="11272" href="plfa.part3.Soundness.html#11235" class="Bound">M</a> <a id="11274" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="11276" href="plfa.part3.Soundness.html#11218" class="Bound">v</a>
    <a id="11282" class="Comment">----------------------------</a>
  <a id="11313" class="Symbol">â†’</a> <a id="11315" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#11222" class="Bound">Î³</a> <a id="11317" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="11319" href="plfa.part3.Soundness.html#11235" class="Bound">M</a> <a id="11321" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="11323" href="plfa.part3.Soundness.html#11218" class="Bound">v</a>
<a id="11325" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#11189" class="Function">rename-inc-reflect</a> <a id="11344" href="plfa.part3.Soundness.html#11344" class="Bound">d</a> <a id="11346" class="Symbol">=</a> <a id="11348" href="plfa.part3.Soundness.html#9054" class="Function">rename-reflect</a> <a id="11363" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8670" class="Function">`âŠ‘-refl</a> <a id="11371" href="plfa.part3.Soundness.html#11344" class="Bound">d</a>
</pre>{% endraw %}

### Substitution reflects denotations, the variable case

We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if `Î³ âŠ¢ (subst Ïƒ M) â†“ v`, then
`Î³ âŠ¢ Ïƒ k â†“ nth k Î´` and `Î´ âŠ¢ M â†“ v` for any `k` and some `Î´`.
We shall start with the case in which `M` is a variable `x`.
So instead the premise is `Î³ âŠ¢ Ïƒ x â†“ v` and we need to show that
`Î´ âŠ¢ x â†“ v` for some `Î´`. The `Î´` that we choose shall be the
environment that maps `x` to `v` and every other variable to `âŠ¥`.

Next we define the environment that maps `x` to `v` and every other
variable to `âŠ¥`, that is `const-env x v`. To tell variables apart, we
define the following function for deciding equality of variables.

{% raw %}<pre class="Agda"><a id="_varâ‰Ÿ_"></a><a id="12093" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12093" class="Function Operator">_varâ‰Ÿ_</a> <a id="12100" class="Symbol">:</a> <a id="12102" class="Symbol">âˆ€</a> <a id="12104" class="Symbol">{</a><a id="12105" href="plfa.part3.Soundness.html#12105" class="Bound">Î“</a><a id="12106" class="Symbol">}</a> <a id="12108" class="Symbol">â†’</a> <a id="12110" class="Symbol">(</a><a id="12111" href="plfa.part3.Soundness.html#12111" class="Bound">x</a> <a id="12113" href="plfa.part3.Soundness.html#12113" class="Bound">y</a> <a id="12115" class="Symbol">:</a> <a id="12117" href="plfa.part3.Soundness.html#12105" class="Bound">Î“</a> <a id="12119" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3511" class="Datatype Operator">âˆ‹</a> <a id="12121" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="12122" class="Symbol">)</a> <a id="12124" class="Symbol">â†’</a> <a id="12126" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#605" class="Datatype">Dec</a> <a id="12130" class="Symbol">(</a><a id="12131" href="plfa.part3.Soundness.html#12111" class="Bound">x</a> <a id="12133" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">â‰¡</a> <a id="12135" href="plfa.part3.Soundness.html#12113" class="Bound">y</a><a id="12136" class="Symbol">)</a>
<a id="12138" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a> <a id="12140" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12093" class="Function Operator">varâ‰Ÿ</a> <a id="12145" href="plfa.part2.Untyped.html#3547" class="InductiveConstructor">Z</a>  <a id="12148" class="Symbol">=</a>  <a id="12151" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12155" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12160" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a> <a id="12162" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12093" class="Function Operator">varâ‰Ÿ</a> <a id="12167" class="Symbol">(</a><a id="12168" href="plfa.part2.Untyped.html#3592" class="InductiveConstructor Operator">S</a> <a id="12170" class="Symbol">_)</a>  <a id="12174" class="Symbol">=</a>  <a id="12177" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12180" class="Symbol">Î»()</a>
<a id="12184" class="Symbol">(</a><a id="12185" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="12187" class="Symbol">_)</a> <a id="12190" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12093" class="Function Operator">varâ‰Ÿ</a> <a id="12195" href="plfa.part2.Untyped.html#3547" class="InductiveConstructor">Z</a>  <a id="12198" class="Symbol">=</a>  <a id="12201" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12204" class="Symbol">Î»()</a>
<a id="12208" class="Symbol">(</a><a id="12209" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="12211" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12211" class="Bound">x</a><a id="12212" class="Symbol">)</a> <a id="12214" href="plfa.part3.Soundness.html#12093" class="Function Operator">varâ‰Ÿ</a> <a id="12219" class="Symbol">(</a><a id="12220" href="plfa.part2.Untyped.html#3592" class="InductiveConstructor Operator">S</a> <a id="12222" href="plfa.part3.Soundness.html#12222" class="Bound">y</a><a id="12223" class="Symbol">)</a> <a id="12225" class="Keyword">with</a>  <a id="12231" href="plfa.part3.Soundness.html#12211" class="Bound">x</a> <a id="12233" href="plfa.part3.Soundness.html#12093" class="Function Operator">varâ‰Ÿ</a> <a id="12238" href="plfa.part3.Soundness.html#12222" class="Bound">y</a>
<a id="12240" class="Symbol">...</a>                 <a id="12260" class="Symbol">|</a>  <a id="12263" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12267" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12272" class="Symbol">=</a>  <a id="12275" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12279" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12284" class="Symbol">...</a>                 <a id="12304" class="Symbol">|</a>  <a id="12307" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12310" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12310" class="Bound">neq</a>   <a id="12316" class="Symbol">=</a>  <a id="12319" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12322" class="Symbol">Î»{</a><a id="12324" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="12329" class="Symbol">â†’</a> <a id="12331" href="plfa.part3.Soundness.html#12310" class="Bound">neq</a> <a id="12335" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="12339" class="Symbol">}</a>

<a id="varâ‰Ÿ-refl"></a><a id="12342" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12342" class="Function">varâ‰Ÿ-refl</a> <a id="12352" class="Symbol">:</a> <a id="12354" class="Symbol">âˆ€</a> <a id="12356" class="Symbol">{</a><a id="12357" href="plfa.part3.Soundness.html#12357" class="Bound">Î“</a><a id="12358" class="Symbol">}</a> <a id="12360" class="Symbol">(</a><a id="12361" href="plfa.part3.Soundness.html#12361" class="Bound">x</a> <a id="12363" class="Symbol">:</a> <a id="12365" href="plfa.part3.Soundness.html#12357" class="Bound">Î“</a> <a id="12367" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3511" class="Datatype Operator">âˆ‹</a> <a id="12369" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="12370" class="Symbol">)</a> <a id="12372" class="Symbol">â†’</a> <a id="12374" class="Symbol">(</a><a id="12375" href="plfa.part3.Soundness.html#12361" class="Bound">x</a> <a id="12377" href="plfa.part3.Soundness.html#12093" class="Function Operator">varâ‰Ÿ</a> <a id="12382" href="plfa.part3.Soundness.html#12361" class="Bound">x</a><a id="12383" class="Symbol">)</a> <a id="12385" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">â‰¡</a> <a id="12387" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12391" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12396" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12342" class="Function">varâ‰Ÿ-refl</a> <a id="12406" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a> <a id="12408" class="Symbol">=</a> <a id="12410" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="12415" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12342" class="Function">varâ‰Ÿ-refl</a> <a id="12425" class="Symbol">(</a><a id="12426" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="12428" href="plfa.part3.Soundness.html#12428" class="Bound">x</a><a id="12429" class="Symbol">)</a> <a id="12431" class="Keyword">rewrite</a> <a id="12439" href="plfa.part3.Soundness.html#12342" class="Function">varâ‰Ÿ-refl</a> <a id="12449" href="plfa.part3.Soundness.html#12428" class="Bound">x</a> <a id="12451" class="Symbol">=</a> <a id="12453" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
Now we use `varâ‰Ÿ` to define `const-env`.

{% raw %}<pre class="Agda"><a id="const-env"></a><a id="12509" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12509" class="Function">const-env</a> <a id="12519" class="Symbol">:</a> <a id="12521" class="Symbol">âˆ€{</a><a id="12523" href="plfa.part3.Soundness.html#12523" class="Bound">Î“</a><a id="12524" class="Symbol">}</a> <a id="12526" class="Symbol">â†’</a> <a id="12528" class="Symbol">(</a><a id="12529" href="plfa.part3.Soundness.html#12529" class="Bound">x</a> <a id="12531" class="Symbol">:</a> <a id="12533" href="plfa.part3.Soundness.html#12523" class="Bound">Î“</a> <a id="12535" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3511" class="Datatype Operator">âˆ‹</a> <a id="12537" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="12538" class="Symbol">)</a> <a id="12540" class="Symbol">â†’</a> <a id="12542" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#4070" class="Datatype">Value</a> <a id="12548" class="Symbol">â†’</a> <a id="12550" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="12554" href="plfa.part3.Soundness.html#12523" class="Bound">Î“</a>
<a id="12556" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12509" class="Function">const-env</a> <a id="12566" href="plfa.part3.Soundness.html#12566" class="Bound">x</a> <a id="12568" href="plfa.part3.Soundness.html#12568" class="Bound">v</a> <a id="12570" href="plfa.part3.Soundness.html#12570" class="Bound">y</a> <a id="12572" class="Keyword">with</a> <a id="12577" href="plfa.part3.Soundness.html#12566" class="Bound">x</a> <a id="12579" href="plfa.part3.Soundness.html#12093" class="Function Operator">varâ‰Ÿ</a> <a id="12584" href="plfa.part3.Soundness.html#12570" class="Bound">y</a>
<a id="12586" class="Symbol">...</a>             <a id="12602" class="Symbol">|</a> <a id="12604" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="12608" class="Symbol">_</a>       <a id="12616" class="Symbol">=</a> <a id="12618" class="Bound">v</a>
<a id="12620" class="Symbol">...</a>             <a id="12636" class="Symbol">|</a> <a id="12638" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="12641" class="Symbol">_</a>        <a id="12650" class="Symbol">=</a> <a id="12652" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#4090" class="InductiveConstructor">âŠ¥</a>
</pre>{% endraw %}
Of course, `const-env x v` maps `x` to value `v`

{% raw %}<pre class="Agda"><a id="same-const-env"></a><a id="12713" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12713" class="Function">same-const-env</a> <a id="12728" class="Symbol">:</a> <a id="12730" class="Symbol">âˆ€{</a><a id="12732" href="plfa.part3.Soundness.html#12732" class="Bound">Î“</a><a id="12733" class="Symbol">}</a> <a id="12735" class="Symbol">{</a><a id="12736" href="plfa.part3.Soundness.html#12736" class="Bound">x</a> <a id="12738" class="Symbol">:</a> <a id="12740" href="plfa.part3.Soundness.html#12732" class="Bound">Î“</a> <a id="12742" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3511" class="Datatype Operator">âˆ‹</a> <a id="12744" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="12745" class="Symbol">}</a> <a id="12747" class="Symbol">{</a><a id="12748" href="plfa.part3.Soundness.html#12748" class="Bound">v</a><a id="12749" class="Symbol">}</a> <a id="12751" class="Symbol">â†’</a> <a id="12753" class="Symbol">(</a><a id="12754" href="plfa.part3.Soundness.html#12509" class="Function">const-env</a> <a id="12764" href="plfa.part3.Soundness.html#12736" class="Bound">x</a> <a id="12766" href="plfa.part3.Soundness.html#12748" class="Bound">v</a><a id="12767" class="Symbol">)</a> <a id="12769" href="plfa.part3.Soundness.html#12736" class="Bound">x</a> <a id="12771" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">â‰¡</a> <a id="12773" href="plfa.part3.Soundness.html#12748" class="Bound">v</a>
<a id="12775" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12713" class="Function">same-const-env</a> <a id="12790" class="Symbol">{</a><a id="12791" class="Argument">x</a> <a id="12793" class="Symbol">=</a> <a id="12795" href="plfa.part3.Soundness.html#12795" class="Bound">x</a><a id="12796" class="Symbol">}</a> <a id="12798" class="Keyword">rewrite</a> <a id="12806" href="plfa.part3.Soundness.html#12342" class="Function">varâ‰Ÿ-refl</a> <a id="12816" href="plfa.part3.Soundness.html#12795" class="Bound">x</a> <a id="12818" class="Symbol">=</a> <a id="12820" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
and `const-env x v` maps `y` to `âŠ¥, so long as `x â‰¢ y`.

{% raw %}<pre class="Agda"><a id="diff-nth-const-env"></a><a id="12891" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12891" class="Function">diff-nth-const-env</a> <a id="12910" class="Symbol">:</a> <a id="12912" class="Symbol">âˆ€{</a><a id="12914" href="plfa.part3.Soundness.html#12914" class="Bound">Î“</a><a id="12915" class="Symbol">}</a> <a id="12917" class="Symbol">{</a><a id="12918" href="plfa.part3.Soundness.html#12918" class="Bound">x</a> <a id="12920" href="plfa.part3.Soundness.html#12920" class="Bound">y</a> <a id="12922" class="Symbol">:</a> <a id="12924" href="plfa.part3.Soundness.html#12914" class="Bound">Î“</a> <a id="12926" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3511" class="Datatype Operator">âˆ‹</a> <a id="12928" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="12929" class="Symbol">}</a> <a id="12931" class="Symbol">{</a><a id="12932" href="plfa.part3.Soundness.html#12932" class="Bound">v</a><a id="12933" class="Symbol">}</a>
  <a id="12937" class="Symbol">â†’</a> <a id="12939" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12918" class="Bound">x</a> <a id="12941" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#799" class="Function Operator">â‰¢</a> <a id="12943" href="plfa.part3.Soundness.html#12920" class="Bound">y</a>
    <a id="12949" class="Comment">-------------------</a>
  <a id="12971" class="Symbol">â†’</a> <a id="12973" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12509" class="Function">const-env</a> <a id="12983" href="plfa.part3.Soundness.html#12918" class="Bound">x</a> <a id="12985" href="plfa.part3.Soundness.html#12932" class="Bound">v</a> <a id="12987" href="plfa.part3.Soundness.html#12920" class="Bound">y</a> <a id="12989" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">â‰¡</a> <a id="12991" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#4090" class="InductiveConstructor">âŠ¥</a>
<a id="12993" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12891" class="Function">diff-nth-const-env</a> <a id="13012" class="Symbol">{</a><a id="13013" href="plfa.part3.Soundness.html#13013" class="Bound">Î“</a><a id="13014" class="Symbol">}</a> <a id="13016" class="Symbol">{</a><a id="13017" href="plfa.part3.Soundness.html#13017" class="Bound">x</a><a id="13018" class="Symbol">}</a> <a id="13020" class="Symbol">{</a><a id="13021" href="plfa.part3.Soundness.html#13021" class="Bound">y</a><a id="13022" class="Symbol">}</a> <a id="13024" href="plfa.part3.Soundness.html#13024" class="Bound">neq</a> <a id="13028" class="Keyword">with</a> <a id="13033" href="plfa.part3.Soundness.html#13017" class="Bound">x</a> <a id="13035" href="plfa.part3.Soundness.html#12093" class="Function Operator">varâ‰Ÿ</a> <a id="13040" href="plfa.part3.Soundness.html#13021" class="Bound">y</a>
<a id="13042" class="Symbol">...</a>  <a id="13047" class="Symbol">|</a> <a id="13049" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="13053" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#13053" class="Bound">eq</a>  <a id="13057" class="Symbol">=</a>  <a id="13060" href="https://agda.github.io/agda-stdlib/v1.1/Data.Empty.html#294" class="Function">âŠ¥-elim</a> <a id="13067" class="Symbol">(</a><a id="13068" class="Bound">neq</a> <a id="13072" href="plfa.part3.Soundness.html#13053" class="Bound">eq</a><a id="13074" class="Symbol">)</a>
<a id="13076" class="Symbol">...</a>  <a id="13081" class="Symbol">|</a> <a id="13083" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="13086" class="Symbol">_</a>    <a id="13091" class="Symbol">=</a>  <a id="13094" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
So we choose `const-env x v` for `Î´` and obtain `Î´ âŠ¢ x â†“ v`
with the `var` rule.

It remains to prove that `Î³ âŠ¢ Ïƒ â†“ Î´` and `Î´ âŠ¢ M â†“ v` for any `k`, given that
we have chosen `const-env x v` for `Î´`.  We shall have two cases to
consider, `x â‰¡ y` or `x â‰¢ y`.

Now to finish the two cases of the proof.

* In the case where `x â‰¡ y`, we need to show
  that `Î³ âŠ¢ Ïƒ y â†“ v`, but that's just our premise.
* In the case where `x â‰¢ y,` we need to show
  that `Î³ âŠ¢ Ïƒ y â†“ âŠ¥`, which we do via rule `âŠ¥-intro`.

Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.

{% raw %}<pre class="Agda"><a id="subst-reflect-var"></a><a id="13750" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#13750" class="Function">subst-reflect-var</a> <a id="13768" class="Symbol">:</a> <a id="13770" class="Symbol">âˆ€</a> <a id="13772" class="Symbol">{</a><a id="13773" href="plfa.part3.Soundness.html#13773" class="Bound">Î“</a> <a id="13775" href="plfa.part3.Soundness.html#13775" class="Bound">Î”</a><a id="13776" class="Symbol">}</a> <a id="13778" class="Symbol">{</a><a id="13779" href="plfa.part3.Soundness.html#13779" class="Bound">Î³</a> <a id="13781" class="Symbol">:</a> <a id="13783" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="13787" href="plfa.part3.Soundness.html#13775" class="Bound">Î”</a><a id="13788" class="Symbol">}</a> <a id="13790" class="Symbol">{</a><a id="13791" href="plfa.part3.Soundness.html#13791" class="Bound">x</a> <a id="13793" class="Symbol">:</a> <a id="13795" href="plfa.part3.Soundness.html#13773" class="Bound">Î“</a> <a id="13797" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3511" class="Datatype Operator">âˆ‹</a> <a id="13799" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="13800" class="Symbol">}</a> <a id="13802" class="Symbol">{</a><a id="13803" href="plfa.part3.Soundness.html#13803" class="Bound">v</a><a id="13804" class="Symbol">}</a> <a id="13806" class="Symbol">{</a><a id="13807" href="plfa.part3.Soundness.html#13807" class="Bound">Ïƒ</a> <a id="13809" class="Symbol">:</a> <a id="13811" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2405" class="Function">Subst</a> <a id="13817" href="plfa.part3.Soundness.html#13773" class="Bound">Î“</a> <a id="13819" href="plfa.part3.Soundness.html#13775" class="Bound">Î”</a><a id="13820" class="Symbol">}</a>
  <a id="13824" class="Symbol">â†’</a> <a id="13826" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#13779" class="Bound">Î³</a> <a id="13828" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="13830" href="plfa.part3.Soundness.html#13807" class="Bound">Ïƒ</a> <a id="13832" href="plfa.part3.Soundness.html#13791" class="Bound">x</a> <a id="13834" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="13836" href="plfa.part3.Soundness.html#13803" class="Bound">v</a>
    <a id="13842" class="Comment">-----------------------------------------</a>
  <a id="13886" class="Symbol">â†’</a> <a id="13888" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Î£[</a> <a id="13891" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#13891" class="Bound">Î´</a> <a id="13893" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">âˆˆ</a> <a id="13895" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="13899" href="plfa.part3.Soundness.html#13773" class="Bound">Î“</a> <a id="13901" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="13903" href="plfa.part3.Soundness.html#13779" class="Bound">Î³</a> <a id="13905" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="13908" href="plfa.part3.Soundness.html#13807" class="Bound">Ïƒ</a> <a id="13910" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="13912" href="plfa.part3.Soundness.html#13891" class="Bound">Î´</a>  <a id="13915" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">Ã—</a>  <a id="13918" href="plfa.part3.Soundness.html#13891" class="Bound">Î´</a> <a id="13920" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="13922" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4316" class="InductiveConstructor Operator">`</a> <a id="13924" href="plfa.part3.Soundness.html#13791" class="Bound">x</a> <a id="13926" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="13928" href="plfa.part3.Soundness.html#13803" class="Bound">v</a>
<a id="13930" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#13750" class="Function">subst-reflect-var</a> <a id="13948" class="Symbol">{</a><a id="13949" href="plfa.part3.Soundness.html#13949" class="Bound">Î“</a><a id="13950" class="Symbol">}{</a><a id="13952" href="plfa.part3.Soundness.html#13952" class="Bound">Î”</a><a id="13953" class="Symbol">}{</a><a id="13955" href="plfa.part3.Soundness.html#13955" class="Bound">Î³</a><a id="13956" class="Symbol">}{</a><a id="13958" href="plfa.part3.Soundness.html#13958" class="Bound">x</a><a id="13959" class="Symbol">}{</a><a id="13961" href="plfa.part3.Soundness.html#13961" class="Bound">v</a><a id="13962" class="Symbol">}{</a><a id="13964" href="plfa.part3.Soundness.html#13964" class="Bound">Ïƒ</a><a id="13965" class="Symbol">}</a> <a id="13967" href="plfa.part3.Soundness.html#13967" class="Bound">xv</a>
  <a id="13972" class="Keyword">rewrite</a> <a id="13980" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="13984" class="Symbol">(</a><a id="13985" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12713" class="Function">same-const-env</a> <a id="14000" class="Symbol">{</a><a id="14001" href="plfa.part3.Soundness.html#13949" class="Bound">Î“</a><a id="14002" class="Symbol">}{</a><a id="14004" href="plfa.part3.Soundness.html#13958" class="Bound">x</a><a id="14005" class="Symbol">}{</a><a id="14007" href="plfa.part3.Soundness.html#13961" class="Bound">v</a><a id="14008" class="Symbol">})</a> <a id="14011" class="Symbol">=</a>
    <a id="14017" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="14019" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#12509" class="Function">const-env</a> <a id="14029" href="plfa.part3.Soundness.html#13958" class="Bound">x</a> <a id="14031" href="plfa.part3.Soundness.html#13961" class="Bound">v</a> <a id="14033" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14035" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="14037" href="plfa.part3.Soundness.html#14070" class="Function">const-env-ok</a> <a id="14050" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="14052" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="14056" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="14058" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
  <a id="14062" class="Keyword">where</a>
  <a id="14070" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14070" class="Function">const-env-ok</a> <a id="14083" class="Symbol">:</a> <a id="14085" href="plfa.part3.Soundness.html#13955" class="Bound">Î³</a> <a id="14087" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="14090" href="plfa.part3.Soundness.html#13964" class="Bound">Ïƒ</a> <a id="14092" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="14094" href="plfa.part3.Soundness.html#12509" class="Function">const-env</a> <a id="14104" href="plfa.part3.Soundness.html#13958" class="Bound">x</a> <a id="14106" href="plfa.part3.Soundness.html#13961" class="Bound">v</a>
  <a id="14110" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14070" class="Function">const-env-ok</a> <a id="14123" href="plfa.part3.Soundness.html#14123" class="Bound">y</a> <a id="14125" class="Keyword">with</a> <a id="14130" href="plfa.part3.Soundness.html#13958" class="Bound">x</a> <a id="14132" href="plfa.part3.Soundness.html#12093" class="Function Operator">varâ‰Ÿ</a> <a id="14137" href="plfa.part3.Soundness.html#14123" class="Bound">y</a>
  <a id="14141" class="Symbol">...</a> <a id="14145" class="Symbol">|</a> <a id="14147" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#641" class="InductiveConstructor">yes</a> <a id="14151" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14151" class="Bound">xâ‰¡y</a> <a id="14155" class="Keyword">rewrite</a> <a id="14163" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="14167" href="plfa.part3.Soundness.html#14151" class="Bound">xâ‰¡y</a> <a id="14171" class="Symbol">|</a> <a id="14173" href="plfa.part3.Soundness.html#12713" class="Function">same-const-env</a> <a id="14188" class="Symbol">{</a><a id="14189" href="plfa.part3.Soundness.html#13949" class="Bound">Î“</a><a id="14190" class="Symbol">}{</a><a id="14192" href="plfa.part3.Soundness.html#13958" class="Bound">x</a><a id="14193" class="Symbol">}{</a><a id="14195" href="plfa.part3.Soundness.html#13961" class="Bound">v</a><a id="14196" class="Symbol">}</a> <a id="14198" class="Symbol">=</a> <a id="14200" href="plfa.part3.Soundness.html#13967" class="Bound">xv</a>
  <a id="14205" class="Symbol">...</a> <a id="14209" class="Symbol">|</a> <a id="14211" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Nullary.html#668" class="InductiveConstructor">no</a> <a id="14214" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14214" class="Bound">xâ‰¢y</a> <a id="14218" class="Keyword">rewrite</a> <a id="14226" href="plfa.part3.Soundness.html#12891" class="Function">diff-nth-const-env</a> <a id="14245" class="Symbol">{</a><a id="14246" href="plfa.part3.Soundness.html#13949" class="Bound">Î“</a><a id="14247" class="Symbol">}{</a><a id="14249" href="plfa.part3.Soundness.html#13958" class="Bound">x</a><a id="14250" class="Symbol">}{</a><a id="14252" class="Bound">y</a><a id="14253" class="Symbol">}{</a><a id="14255" href="plfa.part3.Soundness.html#13961" class="Bound">v</a><a id="14256" class="Symbol">}</a> <a id="14258" href="plfa.part3.Soundness.html#14214" class="Bound">xâ‰¢y</a> <a id="14262" class="Symbol">=</a> <a id="14264" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a>
</pre>{% endraw %}

### Substitutions and environment construction

Every substitution produces terms that can evaluate to `âŠ¥`.

{% raw %}<pre class="Agda"><a id="subst-âŠ¥"></a><a id="14391" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14391" class="Function">subst-âŠ¥</a> <a id="14399" class="Symbol">:</a> <a id="14401" class="Symbol">âˆ€{</a><a id="14403" href="plfa.part3.Soundness.html#14403" class="Bound">Î“</a> <a id="14405" href="plfa.part3.Soundness.html#14405" class="Bound">Î”</a><a id="14406" class="Symbol">}{</a><a id="14408" href="plfa.part3.Soundness.html#14408" class="Bound">Î³</a> <a id="14410" class="Symbol">:</a> <a id="14412" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="14416" href="plfa.part3.Soundness.html#14405" class="Bound">Î”</a><a id="14417" class="Symbol">}{</a><a id="14419" href="plfa.part3.Soundness.html#14419" class="Bound">Ïƒ</a> <a id="14421" class="Symbol">:</a> <a id="14423" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2405" class="Function">Subst</a> <a id="14429" href="plfa.part3.Soundness.html#14403" class="Bound">Î“</a> <a id="14431" href="plfa.part3.Soundness.html#14405" class="Bound">Î”</a><a id="14432" class="Symbol">}</a>
    <a id="14438" class="Comment">-----------------</a>
  <a id="14458" class="Symbol">â†’</a> <a id="14460" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14408" class="Bound">Î³</a> <a id="14462" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="14465" href="plfa.part3.Soundness.html#14419" class="Bound">Ïƒ</a> <a id="14467" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="14469" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8382" class="Function">`âŠ¥</a>
<a id="14472" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14391" class="Function">subst-âŠ¥</a> <a id="14480" href="plfa.part3.Soundness.html#14480" class="Bound">x</a> <a id="14482" class="Symbol">=</a> <a id="14484" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a>
</pre>{% endraw %}
If a substitution produces terms that evaluate to the values in
both `Î³â‚` and `Î³â‚‚`, then those terms also evaluate to the values in
`Î³â‚ âŠ” Î³â‚‚`.

{% raw %}<pre class="Agda"><a id="subst-âŠ”"></a><a id="14645" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14645" class="Function">subst-âŠ”</a> <a id="14653" class="Symbol">:</a> <a id="14655" class="Symbol">âˆ€{</a><a id="14657" href="plfa.part3.Soundness.html#14657" class="Bound">Î“</a> <a id="14659" href="plfa.part3.Soundness.html#14659" class="Bound">Î”</a><a id="14660" class="Symbol">}{</a><a id="14662" href="plfa.part3.Soundness.html#14662" class="Bound">Î³</a> <a id="14664" class="Symbol">:</a> <a id="14666" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="14670" href="plfa.part3.Soundness.html#14659" class="Bound">Î”</a><a id="14671" class="Symbol">}{</a><a id="14673" href="plfa.part3.Soundness.html#14673" class="Bound">Î³â‚</a> <a id="14676" href="plfa.part3.Soundness.html#14676" class="Bound">Î³â‚‚</a> <a id="14679" class="Symbol">:</a> <a id="14681" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="14685" href="plfa.part3.Soundness.html#14657" class="Bound">Î“</a><a id="14686" class="Symbol">}{</a><a id="14688" href="plfa.part3.Soundness.html#14688" class="Bound">Ïƒ</a> <a id="14690" class="Symbol">:</a> <a id="14692" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2405" class="Function">Subst</a> <a id="14698" href="plfa.part3.Soundness.html#14657" class="Bound">Î“</a> <a id="14700" href="plfa.part3.Soundness.html#14659" class="Bound">Î”</a><a id="14701" class="Symbol">}</a>
           <a id="14714" class="Symbol">â†’</a> <a id="14716" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14662" class="Bound">Î³</a> <a id="14718" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="14721" href="plfa.part3.Soundness.html#14688" class="Bound">Ïƒ</a> <a id="14723" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="14725" href="plfa.part3.Soundness.html#14673" class="Bound">Î³â‚</a>
           <a id="14739" class="Symbol">â†’</a> <a id="14741" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14662" class="Bound">Î³</a> <a id="14743" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="14746" href="plfa.part3.Soundness.html#14688" class="Bound">Ïƒ</a> <a id="14748" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="14750" href="plfa.part3.Soundness.html#14676" class="Bound">Î³â‚‚</a>
             <a id="14766" class="Comment">-------------------------</a>
           <a id="14803" class="Symbol">â†’</a> <a id="14805" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14662" class="Bound">Î³</a> <a id="14807" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="14810" href="plfa.part3.Soundness.html#14688" class="Bound">Ïƒ</a> <a id="14812" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="14814" class="Symbol">(</a><a id="14815" href="plfa.part3.Soundness.html#14673" class="Bound">Î³â‚</a> <a id="14818" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8411" class="Function Operator">`âŠ”</a> <a id="14821" href="plfa.part3.Soundness.html#14676" class="Bound">Î³â‚‚</a><a id="14823" class="Symbol">)</a>
<a id="14825" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14645" class="Function">subst-âŠ”</a> <a id="14833" href="plfa.part3.Soundness.html#14833" class="Bound">Î³â‚-ok</a> <a id="14839" href="plfa.part3.Soundness.html#14839" class="Bound">Î³â‚‚-ok</a> <a id="14845" href="plfa.part3.Soundness.html#14845" class="Bound">x</a> <a id="14847" class="Symbol">=</a> <a id="14849" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="14857" class="Symbol">(</a><a id="14858" href="plfa.part3.Soundness.html#14833" class="Bound">Î³â‚-ok</a> <a id="14864" href="plfa.part3.Soundness.html#14845" class="Bound">x</a><a id="14865" class="Symbol">)</a> <a id="14867" class="Symbol">(</a><a id="14868" href="plfa.part3.Soundness.html#14839" class="Bound">Î³â‚‚-ok</a> <a id="14874" href="plfa.part3.Soundness.html#14845" class="Bound">x</a><a id="14875" class="Symbol">)</a>
</pre>{% endraw %}
### The Lambda constructor is injective

{% raw %}<pre class="Agda"><a id="lambda-inj"></a><a id="14927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14927" class="Function">lambda-inj</a> <a id="14938" class="Symbol">:</a> <a id="14940" class="Symbol">âˆ€</a> <a id="14942" class="Symbol">{</a><a id="14943" href="plfa.part3.Soundness.html#14943" class="Bound">Î“</a><a id="14944" class="Symbol">}</a> <a id="14946" class="Symbol">{</a><a id="14947" href="plfa.part3.Soundness.html#14947" class="Bound">M</a> <a id="14949" href="plfa.part3.Soundness.html#14949" class="Bound">N</a> <a id="14951" class="Symbol">:</a> <a id="14953" href="plfa.part3.Soundness.html#14943" class="Bound">Î“</a> <a id="14955" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3185" class="InductiveConstructor Operator">,</a> <a id="14957" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a> <a id="14959" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="14961" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a> <a id="14963" class="Symbol">}</a>
  <a id="14967" class="Symbol">â†’</a> <a id="14969" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">_â‰¡_</a> <a id="14973" class="Symbol">{</a><a id="14974" class="Argument">A</a> <a id="14976" class="Symbol">=</a> <a id="14978" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14943" class="Bound">Î“</a> <a id="14980" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4280" class="Datatype Operator">âŠ¢</a> <a id="14982" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="14983" class="Symbol">}</a> <a id="14985" class="Symbol">(</a><a id="14986" href="plfa.part2.Untyped.html#4368" class="InductiveConstructor Operator">Æ›</a> <a id="14988" href="plfa.part3.Soundness.html#14947" class="Bound">M</a><a id="14989" class="Symbol">)</a> <a id="14991" class="Symbol">(</a><a id="14992" href="plfa.part2.Untyped.html#4368" class="InductiveConstructor Operator">Æ›</a> <a id="14994" href="plfa.part3.Soundness.html#14949" class="Bound">N</a><a id="14995" class="Symbol">)</a>
    <a id="15001" class="Comment">---------------------------</a>
  <a id="15031" class="Symbol">â†’</a> <a id="15033" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14947" class="Bound">M</a> <a id="15035" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">â‰¡</a> <a id="15037" href="plfa.part3.Soundness.html#14949" class="Bound">N</a>
<a id="15039" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14927" class="Function">lambda-inj</a> <a id="15050" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="15055" class="Symbol">=</a> <a id="15057" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
</pre>{% endraw %}
### Simultaneous substitution reflects denotations

In this section we prove a central lemma, that
substitution reflects denotations. That is, if `Î³ âŠ¢ subst Ïƒ M â†“ v`, then
`Î´ âŠ¢ M â†“ v` and `Î³ âŠ¢ Ïƒ â†“ Î´` for some `Î´`. We shall proceed by induction on
the derivation of `Î³ âŠ¢ subst Ïƒ M â†“ v`. This requires a minor
restatement of the lemma, changing the premise to `Î³ âŠ¢ L â†“ v` and
`L â‰¡ subst Ïƒ M`.

{% raw %}<pre class="Agda"><a id="split"></a><a id="15463" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15463" class="Function">split</a> <a id="15469" class="Symbol">:</a> <a id="15471" class="Symbol">âˆ€</a> <a id="15473" class="Symbol">{</a><a id="15474" href="plfa.part3.Soundness.html#15474" class="Bound">Î“</a><a id="15475" class="Symbol">}</a> <a id="15477" class="Symbol">{</a><a id="15478" href="plfa.part3.Soundness.html#15478" class="Bound">M</a> <a id="15480" class="Symbol">:</a> <a id="15482" href="plfa.part3.Soundness.html#15474" class="Bound">Î“</a> <a id="15484" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3185" class="InductiveConstructor Operator">,</a> <a id="15486" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a> <a id="15488" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="15490" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="15491" class="Symbol">}</a> <a id="15493" class="Symbol">{</a><a id="15494" href="plfa.part3.Soundness.html#15494" class="Bound">Î´</a> <a id="15496" class="Symbol">:</a> <a id="15498" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="15502" class="Symbol">(</a><a id="15503" href="plfa.part3.Soundness.html#15474" class="Bound">Î“</a> <a id="15505" href="plfa.part2.Untyped.html#3185" class="InductiveConstructor Operator">,</a> <a id="15507" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="15508" class="Symbol">)}</a> <a id="15511" class="Symbol">{</a><a id="15512" href="plfa.part3.Soundness.html#15512" class="Bound">v</a><a id="15513" class="Symbol">}</a>
  <a id="15517" class="Symbol">â†’</a> <a id="15519" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15494" class="Bound">Î´</a> <a id="15521" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="15523" href="plfa.part3.Soundness.html#15478" class="Bound">M</a> <a id="15525" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="15527" href="plfa.part3.Soundness.html#15512" class="Bound">v</a>
    <a id="15533" class="Comment">--------------------------</a>
  <a id="15562" class="Symbol">â†’</a> <a id="15564" class="Symbol">(</a><a id="15565" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7601" class="Function">init</a> <a id="15570" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15494" class="Bound">Î´</a> <a id="15572" href="plfa.part3.Denotational.html#7364" class="Function Operator">`,</a> <a id="15575" href="plfa.part3.Denotational.html#7656" class="Function">last</a> <a id="15580" href="plfa.part3.Soundness.html#15494" class="Bound">Î´</a><a id="15581" class="Symbol">)</a> <a id="15583" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="15585" href="plfa.part3.Soundness.html#15478" class="Bound">M</a> <a id="15587" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="15589" href="plfa.part3.Soundness.html#15512" class="Bound">v</a>
<a id="15591" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15463" class="Function">split</a> <a id="15597" class="Symbol">{</a><a id="15598" class="Argument">Î´</a> <a id="15600" class="Symbol">=</a> <a id="15602" href="plfa.part3.Soundness.html#15602" class="Bound">Î´</a><a id="15603" class="Symbol">}</a> <a id="15605" href="plfa.part3.Soundness.html#15605" class="Bound">Î´Mv</a> <a id="15609" class="Keyword">rewrite</a> <a id="15617" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7705" class="Function">init-last</a> <a id="15627" href="plfa.part3.Soundness.html#15602" class="Bound">Î´</a> <a id="15629" class="Symbol">=</a> <a id="15631" href="plfa.part3.Soundness.html#15605" class="Bound">Î´Mv</a>

<a id="subst-reflect"></a><a id="15636" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="15650" class="Symbol">:</a> <a id="15652" class="Symbol">âˆ€</a> <a id="15654" class="Symbol">{</a><a id="15655" href="plfa.part3.Soundness.html#15655" class="Bound">Î“</a> <a id="15657" href="plfa.part3.Soundness.html#15657" class="Bound">Î”</a><a id="15658" class="Symbol">}</a> <a id="15660" class="Symbol">{</a><a id="15661" href="plfa.part3.Soundness.html#15661" class="Bound">Î´</a> <a id="15663" class="Symbol">:</a> <a id="15665" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="15669" href="plfa.part3.Soundness.html#15657" class="Bound">Î”</a><a id="15670" class="Symbol">}</a> <a id="15672" class="Symbol">{</a><a id="15673" href="plfa.part3.Soundness.html#15673" class="Bound">M</a> <a id="15675" class="Symbol">:</a> <a id="15677" href="plfa.part3.Soundness.html#15655" class="Bound">Î“</a> <a id="15679" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4280" class="Datatype Operator">âŠ¢</a> <a id="15681" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="15682" class="Symbol">}</a> <a id="15684" class="Symbol">{</a><a id="15685" href="plfa.part3.Soundness.html#15685" class="Bound">v</a><a id="15686" class="Symbol">}</a> <a id="15688" class="Symbol">{</a><a id="15689" href="plfa.part3.Soundness.html#15689" class="Bound">L</a> <a id="15691" class="Symbol">:</a> <a id="15693" href="plfa.part3.Soundness.html#15657" class="Bound">Î”</a> <a id="15695" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="15697" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="15698" class="Symbol">}</a> <a id="15700" class="Symbol">{</a><a id="15701" href="plfa.part3.Soundness.html#15701" class="Bound">Ïƒ</a> <a id="15703" class="Symbol">:</a> <a id="15705" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Substitution.md %}{% raw %}#2405" class="Function">Subst</a> <a id="15711" href="plfa.part3.Soundness.html#15655" class="Bound">Î“</a> <a id="15713" href="plfa.part3.Soundness.html#15657" class="Bound">Î”</a><a id="15714" class="Symbol">}</a>
  <a id="15718" class="Symbol">â†’</a> <a id="15720" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15661" class="Bound">Î´</a> <a id="15722" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="15724" href="plfa.part3.Soundness.html#15689" class="Bound">L</a> <a id="15726" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="15728" href="plfa.part3.Soundness.html#15685" class="Bound">v</a>
  <a id="15732" class="Symbol">â†’</a> <a id="15734" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6949" class="Function">subst</a> <a id="15740" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15701" class="Bound">Ïƒ</a> <a id="15742" href="plfa.part3.Soundness.html#15673" class="Bound">M</a> <a id="15744" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">â‰¡</a> <a id="15746" href="plfa.part3.Soundness.html#15689" class="Bound">L</a>
    <a id="15752" class="Comment">---------------------------------------</a>
  <a id="15794" class="Symbol">â†’</a> <a id="15796" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Î£[</a> <a id="15799" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15799" class="Bound">Î³</a> <a id="15801" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">âˆˆ</a> <a id="15803" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="15807" href="plfa.part3.Soundness.html#15655" class="Bound">Î“</a> <a id="15809" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="15811" href="plfa.part3.Soundness.html#15661" class="Bound">Î´</a> <a id="15813" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="15816" href="plfa.part3.Soundness.html#15701" class="Bound">Ïƒ</a> <a id="15818" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="15820" href="plfa.part3.Soundness.html#15799" class="Bound">Î³</a>  <a id="15823" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">Ã—</a>  <a id="15826" href="plfa.part3.Soundness.html#15799" class="Bound">Î³</a> <a id="15828" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="15830" href="plfa.part3.Soundness.html#15673" class="Bound">M</a> <a id="15832" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="15834" href="plfa.part3.Soundness.html#15685" class="Bound">v</a>

<a id="15837" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="15851" class="Symbol">{</a><a id="15852" class="Argument">M</a> <a id="15854" class="Symbol">=</a> <a id="15856" href="plfa.part3.Soundness.html#15856" class="Bound">M</a><a id="15857" class="Symbol">}{</a><a id="15859" class="Argument">Ïƒ</a> <a id="15861" class="Symbol">=</a> <a id="15863" href="plfa.part3.Soundness.html#15863" class="Bound">Ïƒ</a><a id="15864" class="Symbol">}</a> <a id="15866" class="Symbol">(</a><a id="15867" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="15871" class="Symbol">{</a><a id="15872" class="Argument">x</a> <a id="15874" class="Symbol">=</a> <a id="15876" href="plfa.part3.Soundness.html#15876" class="Bound">y</a><a id="15877" class="Symbol">})</a> <a id="15880" href="plfa.part3.Soundness.html#15880" class="Bound">eqL</a> <a id="15884" class="Keyword">with</a> <a id="15889" href="plfa.part3.Soundness.html#15856" class="Bound">M</a>
<a id="15891" class="Symbol">...</a> <a id="15895" class="Symbol">|</a> <a id="15897" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4316" class="InductiveConstructor Operator">`</a> <a id="15899" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15899" class="Bound">x</a>  <a id="15902" class="Keyword">with</a> <a id="15907" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="15911" class="Symbol">{</a><a id="15912" class="Argument">x</a> <a id="15914" class="Symbol">=</a> <a id="15916" class="Bound">y</a><a id="15917" class="Symbol">}</a>
<a id="15919" class="Symbol">...</a>           <a id="15933" class="Symbol">|</a> <a id="15935" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15935" class="Bound">yv</a>  <a id="15939" class="Keyword">rewrite</a> <a id="15947" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="15951" class="Bound">eqL</a> <a id="15955" class="Symbol">=</a> <a id="15957" href="plfa.part3.Soundness.html#13750" class="Function">subst-reflect-var</a> <a id="15975" class="Symbol">{</a><a id="15976" class="Argument">Ïƒ</a> <a id="15978" class="Symbol">=</a> <a id="15980" class="Bound">Ïƒ</a><a id="15981" class="Symbol">}</a> <a id="15983" href="plfa.part3.Soundness.html#15935" class="Bound">yv</a>
<a id="15986" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16000" class="Symbol">{</a><a id="16001" class="Argument">M</a> <a id="16003" class="Symbol">=</a> <a id="16005" href="plfa.part3.Soundness.html#16005" class="Bound">M</a><a id="16006" class="Symbol">}</a> <a id="16008" class="Symbol">(</a><a id="16009" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="16013" class="Symbol">{</a><a id="16014" class="Argument">x</a> <a id="16016" class="Symbol">=</a> <a id="16018" href="plfa.part3.Soundness.html#16018" class="Bound">y</a><a id="16019" class="Symbol">})</a> <a id="16022" class="Symbol">()</a> <a id="16025" class="Symbol">|</a> <a id="16027" href="plfa.part3.Soundness.html#16027" class="Bound">Mâ‚</a> <a id="16030" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4428" class="InductiveConstructor Operator">Â·</a> <a id="16032" href="plfa.part3.Soundness.html#16032" class="Bound">Mâ‚‚</a>
<a id="16035" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16049" class="Symbol">{</a><a id="16050" class="Argument">M</a> <a id="16052" class="Symbol">=</a> <a id="16054" href="plfa.part3.Soundness.html#16054" class="Bound">M</a><a id="16055" class="Symbol">}</a> <a id="16057" class="Symbol">(</a><a id="16058" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="16062" class="Symbol">{</a><a id="16063" class="Argument">x</a> <a id="16065" class="Symbol">=</a> <a id="16067" href="plfa.part3.Soundness.html#16067" class="Bound">y</a><a id="16068" class="Symbol">})</a> <a id="16071" class="Symbol">()</a> <a id="16074" class="Symbol">|</a> <a id="16076" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="16078" href="plfa.part3.Soundness.html#16078" class="Bound">Mâ€²</a>

<a id="16082" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16096" class="Symbol">{</a><a id="16097" class="Argument">M</a> <a id="16099" class="Symbol">=</a> <a id="16101" href="plfa.part3.Soundness.html#16101" class="Bound">M</a><a id="16102" class="Symbol">}{</a><a id="16104" class="Argument">Ïƒ</a> <a id="16106" class="Symbol">=</a> <a id="16108" href="plfa.part3.Soundness.html#16108" class="Bound">Ïƒ</a><a id="16109" class="Symbol">}</a> <a id="16111" class="Symbol">(</a><a id="16112" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="16119" href="plfa.part3.Soundness.html#16119" class="Bound">dâ‚</a> <a id="16122" href="plfa.part3.Soundness.html#16122" class="Bound">dâ‚‚</a><a id="16124" class="Symbol">)</a> <a id="16126" href="plfa.part3.Soundness.html#16126" class="Bound">eqL</a>
         <a id="16139" class="Keyword">with</a> <a id="16144" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16101" class="Bound">M</a>
<a id="16146" class="Symbol">...</a>    <a id="16153" class="Symbol">|</a> <a id="16155" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4316" class="InductiveConstructor Operator">`</a> <a id="16157" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16157" class="Bound">x</a> <a id="16159" class="Keyword">with</a> <a id="16164" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="16171" class="Bound">dâ‚</a> <a id="16174" class="Bound">dâ‚‚</a>
<a id="16177" class="Symbol">...</a>    <a id="16184" class="Symbol">|</a> <a id="16186" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16186" class="Bound">dâ€²</a> <a id="16189" class="Keyword">rewrite</a> <a id="16197" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16201" class="Bound">eqL</a> <a id="16205" class="Symbol">=</a> <a id="16207" href="plfa.part3.Soundness.html#13750" class="Function">subst-reflect-var</a> <a id="16225" class="Symbol">{</a><a id="16226" class="Argument">Ïƒ</a> <a id="16228" class="Symbol">=</a> <a id="16230" class="Bound">Ïƒ</a><a id="16231" class="Symbol">}</a> <a id="16233" href="plfa.part3.Soundness.html#16186" class="Bound">dâ€²</a>
<a id="16236" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16250" class="Symbol">(</a><a id="16251" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="16258" href="plfa.part3.Soundness.html#16258" class="Bound">dâ‚</a> <a id="16261" href="plfa.part3.Soundness.html#16261" class="Bound">dâ‚‚</a><a id="16263" class="Symbol">)</a> <a id="16265" class="Symbol">()</a> <a id="16268" class="Symbol">|</a> <a id="16270" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="16272" href="plfa.part3.Soundness.html#16272" class="Bound">Mâ€²</a>
<a id="16275" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a><a id="16288" class="Symbol">{</a><a id="16289" href="plfa.part3.Soundness.html#16289" class="Bound">Î“</a><a id="16290" class="Symbol">}{</a><a id="16292" href="plfa.part3.Soundness.html#16292" class="Bound">Î”</a><a id="16293" class="Symbol">}{</a><a id="16295" href="plfa.part3.Soundness.html#16295" class="Bound">Î³</a><a id="16296" class="Symbol">}{</a><a id="16298" class="Argument">Ïƒ</a> <a id="16300" class="Symbol">=</a> <a id="16302" href="plfa.part3.Soundness.html#16302" class="Bound">Ïƒ</a><a id="16303" class="Symbol">}</a> <a id="16305" class="Symbol">(</a><a id="16306" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="16313" href="plfa.part3.Soundness.html#16313" class="Bound">dâ‚</a> <a id="16316" href="plfa.part3.Soundness.html#16316" class="Bound">dâ‚‚</a><a id="16318" class="Symbol">)</a>
   <a id="16323" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16328" class="Symbol">|</a> <a id="16330" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16330" class="Bound">Mâ‚</a> <a id="16333" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4428" class="InductiveConstructor Operator">Â·</a> <a id="16335" href="plfa.part3.Soundness.html#16335" class="Bound">Mâ‚‚</a>
     <a id="16343" class="Keyword">with</a> <a id="16348" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16362" class="Symbol">{</a><a id="16363" class="Argument">M</a> <a id="16365" class="Symbol">=</a> <a id="16367" href="plfa.part3.Soundness.html#16330" class="Bound">Mâ‚</a><a id="16369" class="Symbol">}</a> <a id="16371" href="plfa.part3.Soundness.html#16313" class="Bound">dâ‚</a> <a id="16374" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="16379" class="Symbol">|</a> <a id="16381" href="plfa.part3.Soundness.html#15636" class="Function">subst-reflect</a> <a id="16395" class="Symbol">{</a><a id="16396" class="Argument">M</a> <a id="16398" class="Symbol">=</a> <a id="16400" href="plfa.part3.Soundness.html#16335" class="Bound">Mâ‚‚</a><a id="16402" class="Symbol">}</a> <a id="16404" href="plfa.part3.Soundness.html#16316" class="Bound">dâ‚‚</a> <a id="16407" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="16412" class="Symbol">...</a>     <a id="16420" class="Symbol">|</a> <a id="16422" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16424" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16424" class="Bound">Î´â‚</a> <a id="16427" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16429" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16431" href="plfa.part3.Soundness.html#16431" class="Bound">subst-Î´â‚</a> <a id="16440" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16442" href="plfa.part3.Soundness.html#16442" class="Bound">m1</a> <a id="16445" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="16447" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="16449" class="Symbol">|</a> <a id="16451" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16453" href="plfa.part3.Soundness.html#16453" class="Bound">Î´â‚‚</a> <a id="16456" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16458" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16460" href="plfa.part3.Soundness.html#16460" class="Bound">subst-Î´â‚‚</a> <a id="16469" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16471" href="plfa.part3.Soundness.html#16471" class="Bound">m2</a> <a id="16474" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="16476" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="16478" class="Symbol">=</a>
     <a id="16485" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16487" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16424" class="Bound">Î´â‚</a> <a id="16490" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8411" class="Function Operator">`âŠ”</a> <a id="16493" href="plfa.part3.Soundness.html#16453" class="Bound">Î´â‚‚</a> <a id="16496" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16498" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16500" href="plfa.part3.Soundness.html#14645" class="Function">subst-âŠ”</a> <a id="16508" class="Symbol">{</a><a id="16509" class="Argument">Î³â‚</a> <a id="16512" class="Symbol">=</a> <a id="16514" href="plfa.part3.Soundness.html#16424" class="Bound">Î´â‚</a><a id="16516" class="Symbol">}{</a><a id="16518" class="Argument">Î³â‚‚</a> <a id="16521" class="Symbol">=</a> <a id="16523" href="plfa.part3.Soundness.html#16453" class="Bound">Î´â‚‚</a><a id="16525" class="Symbol">}{</a><a id="16527" class="Argument">Ïƒ</a> <a id="16529" class="Symbol">=</a> <a id="16531" class="Bound">Ïƒ</a><a id="16532" class="Symbol">}</a> <a id="16534" href="plfa.part3.Soundness.html#16431" class="Bound">subst-Î´â‚</a> <a id="16543" href="plfa.part3.Soundness.html#16460" class="Bound">subst-Î´â‚‚</a> <a id="16552" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="16574" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="16581" class="Symbol">(</a><a id="16582" href="plfa.part3.Denotational.html#25866" class="Function">âŠ‘-env</a> <a id="16588" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16442" class="Bound">m1</a> <a id="16591" class="Symbol">(</a><a id="16592" href="plfa.part3.Denotational.html#8741" class="Function">âŠ‘-env-conj-R1</a> <a id="16606" href="plfa.part3.Soundness.html#16424" class="Bound">Î´â‚</a> <a id="16609" href="plfa.part3.Soundness.html#16453" class="Bound">Î´â‚‚</a><a id="16611" class="Symbol">))</a>
                           <a id="16641" class="Symbol">(</a><a id="16642" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#25866" class="Function">âŠ‘-env</a> <a id="16648" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16471" class="Bound">m2</a> <a id="16651" class="Symbol">(</a><a id="16652" href="plfa.part3.Denotational.html#8847" class="Function">âŠ‘-env-conj-R2</a> <a id="16666" href="plfa.part3.Soundness.html#16424" class="Bound">Î´â‚</a> <a id="16669" href="plfa.part3.Soundness.html#16453" class="Bound">Î´â‚‚</a><a id="16671" class="Symbol">))</a> <a id="16674" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="16676" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>

<a id="16679" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16693" class="Symbol">{</a><a id="16694" class="Argument">M</a> <a id="16696" class="Symbol">=</a> <a id="16698" href="plfa.part3.Soundness.html#16698" class="Bound">M</a><a id="16699" class="Symbol">}{</a><a id="16701" class="Argument">Ïƒ</a> <a id="16703" class="Symbol">=</a> <a id="16705" href="plfa.part3.Soundness.html#16705" class="Bound">Ïƒ</a><a id="16706" class="Symbol">}</a> <a id="16708" class="Symbol">(</a><a id="16709" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="16717" href="plfa.part3.Soundness.html#16717" class="Bound">d</a><a id="16718" class="Symbol">)</a> <a id="16720" href="plfa.part3.Soundness.html#16720" class="Bound">eqL</a> <a id="16724" class="Keyword">with</a> <a id="16729" href="plfa.part3.Soundness.html#16698" class="Bound">M</a>
<a id="16731" class="Symbol">...</a>    <a id="16738" class="Symbol">|</a> <a id="16740" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4316" class="InductiveConstructor Operator">`</a> <a id="16742" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16742" class="Bound">x</a> <a id="16744" class="Keyword">with</a> <a id="16749" class="Symbol">(</a><a id="16750" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="16758" class="Bound">d</a><a id="16759" class="Symbol">)</a>
<a id="16761" class="Symbol">...</a>             <a id="16777" class="Symbol">|</a> <a id="16779" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16779" class="Bound">dâ€²</a> <a id="16782" class="Keyword">rewrite</a> <a id="16790" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="16794" class="Bound">eqL</a> <a id="16798" class="Symbol">=</a> <a id="16800" href="plfa.part3.Soundness.html#13750" class="Function">subst-reflect-var</a> <a id="16818" class="Symbol">{</a><a id="16819" class="Argument">Ïƒ</a> <a id="16821" class="Symbol">=</a> <a id="16823" class="Bound">Ïƒ</a><a id="16824" class="Symbol">}</a> <a id="16826" href="plfa.part3.Soundness.html#16779" class="Bound">dâ€²</a>
<a id="16829" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16843" class="Symbol">{</a><a id="16844" class="Argument">Ïƒ</a> <a id="16846" class="Symbol">=</a> <a id="16848" href="plfa.part3.Soundness.html#16848" class="Bound">Ïƒ</a><a id="16849" class="Symbol">}</a> <a id="16851" class="Symbol">(</a><a id="16852" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="16860" href="plfa.part3.Soundness.html#16860" class="Bound">d</a><a id="16861" class="Symbol">)</a> <a id="16863" href="plfa.part3.Soundness.html#16863" class="Bound">eq</a> <a id="16866" class="Symbol">|</a> <a id="16868" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="16870" href="plfa.part3.Soundness.html#16870" class="Bound">Mâ€²</a>
      <a id="16879" class="Keyword">with</a> <a id="16884" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="16898" class="Symbol">{</a><a id="16899" class="Argument">Ïƒ</a> <a id="16901" class="Symbol">=</a> <a id="16903" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#6657" class="Function">exts</a> <a id="16908" href="plfa.part3.Soundness.html#16848" class="Bound">Ïƒ</a><a id="16909" class="Symbol">}</a> <a id="16911" href="plfa.part3.Soundness.html#16860" class="Bound">d</a> <a id="16913" class="Symbol">(</a><a id="16914" href="plfa.part3.Soundness.html#14927" class="Function">lambda-inj</a> <a id="16925" href="plfa.part3.Soundness.html#16863" class="Bound">eq</a><a id="16927" class="Symbol">)</a>
<a id="16929" class="Symbol">...</a> <a id="16933" class="Symbol">|</a> <a id="16935" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16937" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16937" class="Bound">Î´â€²</a> <a id="16940" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16942" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16944" href="plfa.part3.Soundness.html#16944" class="Bound">exts-Ïƒ-Î´â€²</a> <a id="16954" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16956" href="plfa.part3.Soundness.html#16956" class="Bound">mâ€²</a> <a id="16959" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="16961" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="16963" class="Symbol">=</a>
    <a id="16969" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16971" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7601" class="Function">init</a> <a id="16976" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#16937" class="Bound">Î´â€²</a> <a id="16979" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="16981" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="16983" class="Symbol">((Î»</a> <a id="16987" href="plfa.part3.Soundness.html#16987" class="Bound">x</a> <a id="16989" class="Symbol">â†’</a> <a id="16991" href="plfa.part3.Soundness.html#11189" class="Function">rename-inc-reflect</a> <a id="17010" class="Symbol">(</a><a id="17011" href="plfa.part3.Soundness.html#16944" class="Bound">exts-Ïƒ-Î´â€²</a> <a id="17021" class="Symbol">(</a><a id="17022" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="17024" href="plfa.part3.Soundness.html#16987" class="Bound">x</a><a id="17025" class="Symbol">))))</a> <a id="17030" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
             <a id="17045" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="17053" class="Symbol">(</a><a id="17054" href="plfa.part3.Denotational.html#26297" class="Function">up-env</a> <a id="17061" class="Symbol">(</a><a id="17062" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15463" class="Function">split</a> <a id="17068" href="plfa.part3.Soundness.html#16956" class="Bound">mâ€²</a><a id="17070" class="Symbol">)</a> <a id="17072" class="Symbol">(</a><a id="17073" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Compositional.md %}{% raw %}#10031" class="Function">var-inv</a> <a id="17081" class="Symbol">(</a><a id="17082" href="plfa.part3.Soundness.html#16944" class="Bound">exts-Ïƒ-Î´â€²</a> <a id="17092" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a><a id="17093" class="Symbol">)))</a> <a id="17097" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17099" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
<a id="17101" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="17115" class="Symbol">(</a><a id="17116" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="17124" href="plfa.part3.Soundness.html#17124" class="Bound">d</a><a id="17125" class="Symbol">)</a> <a id="17127" class="Symbol">()</a> <a id="17130" class="Symbol">|</a> <a id="17132" href="plfa.part3.Soundness.html#17132" class="Bound">Mâ‚</a> <a id="17135" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4428" class="InductiveConstructor Operator">Â·</a> <a id="17137" href="plfa.part3.Soundness.html#17137" class="Bound">Mâ‚‚</a>

<a id="17141" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="17155" class="Symbol">{</a><a id="17156" class="Argument">Ïƒ</a> <a id="17158" class="Symbol">=</a> <a id="17160" href="plfa.part3.Soundness.html#17160" class="Bound">Ïƒ</a><a id="17161" class="Symbol">}</a> <a id="17163" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a> <a id="17171" href="plfa.part3.Soundness.html#17171" class="Bound">eq</a> <a id="17174" class="Symbol">=</a>
    <a id="17180" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17182" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8382" class="Function">`âŠ¥</a> <a id="17185" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17187" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17189" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#14391" class="Function">subst-âŠ¥</a> <a id="17197" class="Symbol">{</a><a id="17198" class="Argument">Ïƒ</a> <a id="17200" class="Symbol">=</a> <a id="17202" href="plfa.part3.Soundness.html#17160" class="Bound">Ïƒ</a><a id="17203" class="Symbol">}</a> <a id="17205" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17207" href="plfa.part3.Denotational.html#9780" class="InductiveConstructor">âŠ¥-intro</a> <a id="17215" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17217" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>

<a id="17220" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="17234" class="Symbol">{</a><a id="17235" class="Argument">Ïƒ</a> <a id="17237" class="Symbol">=</a> <a id="17239" href="plfa.part3.Soundness.html#17239" class="Bound">Ïƒ</a><a id="17240" class="Symbol">}</a> <a id="17242" class="Symbol">(</a><a id="17243" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="17251" href="plfa.part3.Soundness.html#17251" class="Bound">dâ‚</a> <a id="17254" href="plfa.part3.Soundness.html#17254" class="Bound">dâ‚‚</a><a id="17256" class="Symbol">)</a> <a id="17258" href="plfa.part3.Soundness.html#17258" class="Bound">eq</a>
  <a id="17263" class="Keyword">with</a> <a id="17268" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="17282" class="Symbol">{</a><a id="17283" class="Argument">Ïƒ</a> <a id="17285" class="Symbol">=</a> <a id="17287" href="plfa.part3.Soundness.html#17239" class="Bound">Ïƒ</a><a id="17288" class="Symbol">}</a> <a id="17290" href="plfa.part3.Soundness.html#17251" class="Bound">dâ‚</a> <a id="17293" href="plfa.part3.Soundness.html#17258" class="Bound">eq</a> <a id="17296" class="Symbol">|</a> <a id="17298" href="plfa.part3.Soundness.html#15636" class="Function">subst-reflect</a> <a id="17312" class="Symbol">{</a><a id="17313" class="Argument">Ïƒ</a> <a id="17315" class="Symbol">=</a> <a id="17317" href="plfa.part3.Soundness.html#17239" class="Bound">Ïƒ</a><a id="17318" class="Symbol">}</a> <a id="17320" href="plfa.part3.Soundness.html#17254" class="Bound">dâ‚‚</a> <a id="17323" href="plfa.part3.Soundness.html#17258" class="Bound">eq</a>
<a id="17326" class="Symbol">...</a> <a id="17330" class="Symbol">|</a> <a id="17332" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17334" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#17334" class="Bound">Î´â‚</a> <a id="17337" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17339" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17341" href="plfa.part3.Soundness.html#17341" class="Bound">subst-Î´â‚</a> <a id="17350" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17352" href="plfa.part3.Soundness.html#17352" class="Bound">m1</a> <a id="17355" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17357" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17359" class="Symbol">|</a> <a id="17361" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17363" href="plfa.part3.Soundness.html#17363" class="Bound">Î´â‚‚</a> <a id="17366" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17368" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17370" href="plfa.part3.Soundness.html#17370" class="Bound">subst-Î´â‚‚</a> <a id="17379" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17381" href="plfa.part3.Soundness.html#17381" class="Bound">m2</a> <a id="17384" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17386" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17388" class="Symbol">=</a>
     <a id="17395" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17397" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#17334" class="Bound">Î´â‚</a> <a id="17400" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8411" class="Function Operator">`âŠ”</a> <a id="17403" href="plfa.part3.Soundness.html#17363" class="Bound">Î´â‚‚</a> <a id="17406" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17408" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17410" href="plfa.part3.Soundness.html#14645" class="Function">subst-âŠ”</a> <a id="17418" class="Symbol">{</a><a id="17419" class="Argument">Î³â‚</a> <a id="17422" class="Symbol">=</a> <a id="17424" href="plfa.part3.Soundness.html#17334" class="Bound">Î´â‚</a><a id="17426" class="Symbol">}{</a><a id="17428" class="Argument">Î³â‚‚</a> <a id="17431" class="Symbol">=</a> <a id="17433" href="plfa.part3.Soundness.html#17363" class="Bound">Î´â‚‚</a><a id="17435" class="Symbol">}{</a><a id="17437" class="Argument">Ïƒ</a> <a id="17439" class="Symbol">=</a> <a id="17441" class="Bound">Ïƒ</a><a id="17442" class="Symbol">}</a> <a id="17444" href="plfa.part3.Soundness.html#17341" class="Bound">subst-Î´â‚</a> <a id="17453" href="plfa.part3.Soundness.html#17370" class="Bound">subst-Î´â‚‚</a> <a id="17462" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a>
                    <a id="17484" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="17492" class="Symbol">(</a><a id="17493" href="plfa.part3.Denotational.html#25866" class="Function">âŠ‘-env</a> <a id="17499" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#17352" class="Bound">m1</a> <a id="17502" class="Symbol">(</a><a id="17503" href="plfa.part3.Denotational.html#8741" class="Function">âŠ‘-env-conj-R1</a> <a id="17517" href="plfa.part3.Soundness.html#17334" class="Bound">Î´â‚</a> <a id="17520" href="plfa.part3.Soundness.html#17363" class="Bound">Î´â‚‚</a><a id="17522" class="Symbol">))</a>
                            <a id="17553" class="Symbol">(</a><a id="17554" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#25866" class="Function">âŠ‘-env</a> <a id="17560" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#17381" class="Bound">m2</a> <a id="17563" class="Symbol">(</a><a id="17564" href="plfa.part3.Denotational.html#8847" class="Function">âŠ‘-env-conj-R2</a> <a id="17578" href="plfa.part3.Soundness.html#17334" class="Bound">Î´â‚</a> <a id="17581" href="plfa.part3.Soundness.html#17363" class="Bound">Î´â‚‚</a><a id="17583" class="Symbol">))</a> <a id="17586" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17588" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
<a id="17590" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="17604" class="Symbol">(</a><a id="17605" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="17609" href="plfa.part3.Soundness.html#17609" class="Bound">d</a> <a id="17611" href="plfa.part3.Soundness.html#17611" class="Bound">lt</a><a id="17613" class="Symbol">)</a> <a id="17615" href="plfa.part3.Soundness.html#17615" class="Bound">eq</a>
    <a id="17622" class="Keyword">with</a> <a id="17627" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#15636" class="Function">subst-reflect</a> <a id="17641" href="plfa.part3.Soundness.html#17609" class="Bound">d</a> <a id="17643" href="plfa.part3.Soundness.html#17615" class="Bound">eq</a>
<a id="17646" class="Symbol">...</a> <a id="17650" class="Symbol">|</a> <a id="17652" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17654" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#17654" class="Bound">Î´</a> <a id="17656" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17658" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17660" href="plfa.part3.Soundness.html#17660" class="Bound">subst-Î´</a> <a id="17668" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17670" href="plfa.part3.Soundness.html#17670" class="Bound">m</a> <a id="17672" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17674" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17676" class="Symbol">=</a> <a id="17678" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17680" href="plfa.part3.Soundness.html#17654" class="Bound">Î´</a> <a id="17682" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17684" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="17686" href="plfa.part3.Soundness.html#17660" class="Bound">subst-Î´</a> <a id="17694" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="17696" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="17700" href="plfa.part3.Soundness.html#17670" class="Bound">m</a> <a id="17702" class="Bound">lt</a> <a id="17705" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="17707" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
</pre>{% endraw %}
* Case `var`: We have subst `Ïƒ M â‰¡ y`, so `M` must also be a variable, say `x`.
  We apply the lemma `subst-reflect-var` to conclude.

* Case `â†¦-elim`: We have `subst Ïƒ M â‰¡ Lâ‚ Â· Lâ‚‚`. We proceed by cases on `M`.
  * Case `M â‰¡ x`: We apply the `subst-reflect-var` lemma again to conclude.

  * Case `M â‰¡ Mâ‚ Â· Mâ‚‚`: By the induction hypothesis, we have
    some `Î´â‚` and `Î´â‚‚` such that `Î´â‚ âŠ¢ Mâ‚ â†“ vâ‚ â†¦ vâ‚ƒ` and `Î³ âŠ¢ Ïƒ â†“ Î´â‚`,
    as well as `Î´â‚‚ âŠ¢ Mâ‚‚ â†“ vâ‚` and `Î³ âŠ¢ Ïƒ â†“ Î´â‚‚`.
    By `âŠ‘-env` we have `Î´â‚ âŠ” Î´â‚‚ âŠ¢ Mâ‚ â†“ vâ‚ â†¦ vâ‚ƒ` and `Î´â‚ âŠ” Î´â‚‚ âŠ¢ Mâ‚‚ â†“ vâ‚`
    (using `âŠ‘-env-conj-R1` and `âŠ‘-env-conj-R2`), and therefore
    `Î´â‚ âŠ” Î´â‚‚ âŠ¢ Mâ‚ Â· Mâ‚‚ â†“ vâ‚ƒ`.
    We conclude this case by obtaining `Î³ âŠ¢ Ïƒ â†“ Î´â‚ âŠ” Î´â‚‚`
    by the `subst-âŠ”` lemma.

* Case `â†¦-intro`: We have `subst Ïƒ M â‰¡ Æ› Lâ€²`. We proceed by cases on `M`.
  * Case `M â‰¡ x`: We apply the `subst-reflect-var` lemma.

  * Case `M â‰¡ Æ› Mâ€²`: By the induction hypothesis, we have
    `(Î´â€² , vâ€²) âŠ¢ Mâ€² â†“ vâ‚‚` and `(Î´ , vâ‚) âŠ¢ exts Ïƒ â†“ (Î´â€² , vâ€²)`.
    From the later we have `(Î´ , vâ‚) âŠ¢ # 0 â†“ vâ€²`.
    By the lemma `var-inv` we have `vâ€² âŠ‘ vâ‚`, so by the `up-env` lemma we
    have `(Î´â€² , vâ‚) âŠ¢ Mâ€² â†“ vâ‚‚` and therefore `Î´â€² âŠ¢ Æ› Mâ€² â†“ vâ‚ â†’ vâ‚‚`.  We
    also need to show that `Î´ `âŠ¢ Ïƒ â†“ Î´â€²`.  Fix `k`. We have
    `(Î´ , vâ‚) âŠ¢ rename S_ Ïƒ k â†“ nth k Î´â€²`.  We then apply the lemma
    `rename-inc-reflect` to obtain `Î´ âŠ¢ Ïƒ k â†“ nth k Î´â€²`, so this case is
    complete.

* Case `âŠ¥-intro`: We choose `âŠ¥` for `Î´`.
  We have `âŠ¥ âŠ¢ M â†“ âŠ¥` by `âŠ¥-intro`.
  We have `Î´ âŠ¢ Ïƒ â†“ âŠ¥` by the lemma `subst-empty`.

* Case `âŠ”-intro`: By the induction hypothesis we have
  `Î´â‚ âŠ¢ M â†“ vâ‚`, `Î´â‚‚ âŠ¢ M â†“ vâ‚‚`, `Î´ âŠ¢ Ïƒ â†“ Î´â‚`, and `Î´ âŠ¢ Ïƒ â†“ Î´â‚‚`.
  We have `Î´â‚ âŠ” Î´â‚‚ âŠ¢ M â†“ vâ‚` and `Î´â‚ âŠ” Î´â‚‚ âŠ¢ M â†“ vâ‚‚`
  by `âŠ‘-env` with `âŠ‘-env-conj-R1` and `âŠ‘-env-conj-R2`.
  So by `âŠ”-intro` we have `Î´â‚ âŠ” Î´â‚‚ âŠ¢ M â†“ vâ‚ âŠ” vâ‚‚`.
  By `subst-âŠ”` we conclude that `Î´ âŠ¢ Ïƒ â†“ Î´â‚ âŠ” Î´â‚‚`.


### Single substitution reflects denotations

Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, Î² reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
given terms `N : (Î“ , â˜… âŠ¢ â˜…)` and `M : (Î“ âŠ¢ â˜…)`,
if `Î³ âŠ¢ N [ M ] â†“ w`, then `Î³ âŠ¢ M â†“ v` and `(Î³ , v) âŠ¢ N â†“ w`
for some value `v`. We have `N [ M ] = subst (subst-zero M) N`.

We first prove a lemma about `subst-zero`, that if
`Î´ âŠ¢ subst-zero M â†“ Î³`, then
`Î³ âŠ‘ (Î´ , w) Ã— Î´ âŠ¢ M â†“ w` for some `w`.

{% raw %}<pre class="Agda"><a id="subst-zero-reflect"></a><a id="20145" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20145" class="Function">subst-zero-reflect</a> <a id="20164" class="Symbol">:</a> <a id="20166" class="Symbol">âˆ€</a> <a id="20168" class="Symbol">{</a><a id="20169" href="plfa.part3.Soundness.html#20169" class="Bound">Î”</a><a id="20170" class="Symbol">}</a> <a id="20172" class="Symbol">{</a><a id="20173" href="plfa.part3.Soundness.html#20173" class="Bound">Î´</a> <a id="20175" class="Symbol">:</a> <a id="20177" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="20181" href="plfa.part3.Soundness.html#20169" class="Bound">Î”</a><a id="20182" class="Symbol">}</a> <a id="20184" class="Symbol">{</a><a id="20185" href="plfa.part3.Soundness.html#20185" class="Bound">Î³</a> <a id="20187" class="Symbol">:</a> <a id="20189" href="plfa.part3.Denotational.html#7207" class="Function">Env</a> <a id="20193" class="Symbol">(</a><a id="20194" href="plfa.part3.Soundness.html#20169" class="Bound">Î”</a> <a id="20196" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3185" class="InductiveConstructor Operator">,</a> <a id="20198" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="20199" class="Symbol">)}</a> <a id="20202" class="Symbol">{</a><a id="20203" href="plfa.part3.Soundness.html#20203" class="Bound">M</a> <a id="20205" class="Symbol">:</a> <a id="20207" href="plfa.part3.Soundness.html#20169" class="Bound">Î”</a> <a id="20209" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="20211" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="20212" class="Symbol">}</a>
  <a id="20216" class="Symbol">â†’</a> <a id="20218" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20173" class="Bound">Î´</a> <a id="20220" href="plfa.part3.Soundness.html#3196" class="Function Operator">`âŠ¢</a> <a id="20223" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#7361" class="Function">subst-zero</a> <a id="20234" href="plfa.part3.Soundness.html#20203" class="Bound">M</a> <a id="20236" href="plfa.part3.Soundness.html#3196" class="Function Operator">â†“</a> <a id="20238" href="plfa.part3.Soundness.html#20185" class="Bound">Î³</a>
    <a id="20244" class="Comment">----------------------------------------</a>
  <a id="20287" class="Symbol">â†’</a> <a id="20289" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Î£[</a> <a id="20292" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20292" class="Bound">w</a> <a id="20294" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">âˆˆ</a> <a id="20296" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#4070" class="Datatype">Value</a> <a id="20302" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="20304" href="plfa.part3.Soundness.html#20185" class="Bound">Î³</a> <a id="20306" href="plfa.part3.Denotational.html#8179" class="Function Operator">`âŠ‘</a> <a id="20309" class="Symbol">(</a><a id="20310" href="plfa.part3.Soundness.html#20173" class="Bound">Î´</a> <a id="20312" href="plfa.part3.Denotational.html#7364" class="Function Operator">`,</a> <a id="20315" href="plfa.part3.Soundness.html#20292" class="Bound">w</a><a id="20316" class="Symbol">)</a> <a id="20318" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">Ã—</a> <a id="20320" href="plfa.part3.Soundness.html#20173" class="Bound">Î´</a> <a id="20322" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="20324" href="plfa.part3.Soundness.html#20203" class="Bound">M</a> <a id="20326" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="20328" href="plfa.part3.Soundness.html#20292" class="Bound">w</a>
<a id="20330" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20145" class="Function">subst-zero-reflect</a> <a id="20349" class="Symbol">{</a><a id="20350" class="Argument">Î´</a> <a id="20352" class="Symbol">=</a> <a id="20354" href="plfa.part3.Soundness.html#20354" class="Bound">Î´</a><a id="20355" class="Symbol">}</a> <a id="20357" class="Symbol">{</a><a id="20358" class="Argument">Î³</a> <a id="20360" class="Symbol">=</a> <a id="20362" href="plfa.part3.Soundness.html#20362" class="Bound">Î³</a><a id="20363" class="Symbol">}</a> <a id="20365" href="plfa.part3.Soundness.html#20365" class="Bound">Î´ÏƒÎ³</a> <a id="20369" class="Symbol">=</a> <a id="20371" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="20373" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7656" class="Function">last</a> <a id="20378" href="plfa.part3.Soundness.html#20362" class="Bound">Î³</a> <a id="20380" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20382" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="20384" href="plfa.part3.Soundness.html#20412" class="Function">lemma</a> <a id="20390" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="20392" href="plfa.part3.Soundness.html#20365" class="Bound">Î´ÏƒÎ³</a> <a id="20396" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a> <a id="20398" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="20400" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
  <a id="20404" class="Keyword">where</a>
  <a id="20412" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20412" class="Function">lemma</a> <a id="20418" class="Symbol">:</a> <a id="20420" href="plfa.part3.Soundness.html#20362" class="Bound">Î³</a> <a id="20422" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#8179" class="Function Operator">`âŠ‘</a> <a id="20425" class="Symbol">(</a><a id="20426" href="plfa.part3.Soundness.html#20354" class="Bound">Î´</a> <a id="20428" href="plfa.part3.Denotational.html#7364" class="Function Operator">`,</a> <a id="20431" href="plfa.part3.Denotational.html#7656" class="Function">last</a> <a id="20436" href="plfa.part3.Soundness.html#20362" class="Bound">Î³</a><a id="20437" class="Symbol">)</a>
  <a id="20441" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20412" class="Function">lemma</a> <a id="20447" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3547" class="InductiveConstructor">Z</a>  <a id="20450" class="Symbol">=</a>  <a id="20453" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#5557" class="Function">âŠ‘-refl</a>
  <a id="20462" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20412" class="Function">lemma</a> <a id="20468" class="Symbol">(</a><a id="20469" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3592" class="InductiveConstructor Operator">S</a> <a id="20471" href="plfa.part3.Soundness.html#20471" class="Bound">x</a><a id="20472" class="Symbol">)</a> <a id="20474" class="Symbol">=</a> <a id="20476" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Compositional.md %}{% raw %}#10031" class="Function">var-inv</a> <a id="20484" class="Symbol">(</a><a id="20485" href="plfa.part3.Soundness.html#20365" class="Bound">Î´ÏƒÎ³</a> <a id="20489" class="Symbol">(</a><a id="20490" href="plfa.part2.Untyped.html#3592" class="InductiveConstructor Operator">S</a> <a id="20492" href="plfa.part3.Soundness.html#20471" class="Bound">x</a><a id="20493" class="Symbol">))</a>
</pre>{% endraw %}
We choose `w` to be the last value in `Î³` and we obtain `Î´ âŠ¢ M â†“ w`
by applying the premise to variable `Z`. Finally, to prove
`Î³ âŠ‘ (Î´ , w)`, we prove a lemma by induction in the input variable.
The base case is trivial because of our choice of `w`.
In the induction case, `S x`, the premise
`Î´ âŠ¢ subst-zero M â†“ Î³` gives us `Î´ âŠ¢ x â†“ Î³ (S x)` and then
using `var-inv` we conclude that `Î³ (S x) âŠ‘ (Î´ `, w) (S x)`.

Now to prove that substitution reflects denotations.

{% raw %}<pre class="Agda"><a id="substitution-reflect"></a><a id="20972" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20972" class="Function">substitution-reflect</a> <a id="20993" class="Symbol">:</a> <a id="20995" class="Symbol">âˆ€</a> <a id="20997" class="Symbol">{</a><a id="20998" href="plfa.part3.Soundness.html#20998" class="Bound">Î”</a><a id="20999" class="Symbol">}</a> <a id="21001" class="Symbol">{</a><a id="21002" href="plfa.part3.Soundness.html#21002" class="Bound">Î´</a> <a id="21004" class="Symbol">:</a> <a id="21006" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="21010" href="plfa.part3.Soundness.html#20998" class="Bound">Î”</a><a id="21011" class="Symbol">}</a> <a id="21013" class="Symbol">{</a><a id="21014" href="plfa.part3.Soundness.html#21014" class="Bound">N</a> <a id="21016" class="Symbol">:</a> <a id="21018" href="plfa.part3.Soundness.html#20998" class="Bound">Î”</a> <a id="21020" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#3185" class="InductiveConstructor Operator">,</a> <a id="21022" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a> <a id="21024" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="21026" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="21027" class="Symbol">}</a> <a id="21029" class="Symbol">{</a><a id="21030" href="plfa.part3.Soundness.html#21030" class="Bound">M</a> <a id="21032" class="Symbol">:</a> <a id="21034" href="plfa.part3.Soundness.html#20998" class="Bound">Î”</a> <a id="21036" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="21038" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="21039" class="Symbol">}</a> <a id="21041" class="Symbol">{</a><a id="21042" href="plfa.part3.Soundness.html#21042" class="Bound">v</a><a id="21043" class="Symbol">}</a>
  <a id="21047" class="Symbol">â†’</a> <a id="21049" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21002" class="Bound">Î´</a> <a id="21051" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="21053" href="plfa.part3.Soundness.html#21014" class="Bound">N</a> <a id="21055" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#7477" class="Function Operator">[</a> <a id="21057" href="plfa.part3.Soundness.html#21030" class="Bound">M</a> <a id="21059" href="plfa.part2.Untyped.html#7477" class="Function Operator">]</a> <a id="21061" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="21063" href="plfa.part3.Soundness.html#21042" class="Bound">v</a>
    <a id="21069" class="Comment">------------------------------------------------</a>
  <a id="21120" class="Symbol">â†’</a> <a id="21122" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">Î£[</a> <a id="21125" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21125" class="Bound">w</a> <a id="21127" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">âˆˆ</a> <a id="21129" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#4070" class="Datatype">Value</a> <a id="21135" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#911" class="Function">]</a> <a id="21137" href="plfa.part3.Soundness.html#21002" class="Bound">Î´</a> <a id="21139" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="21141" href="plfa.part3.Soundness.html#21030" class="Bound">M</a> <a id="21143" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="21145" href="plfa.part3.Soundness.html#21125" class="Bound">w</a>  <a id="21148" href="https://agda.github.io/agda-stdlib/v1.1/Data.Product.html#1162" class="Function Operator">Ã—</a>  <a id="21151" class="Symbol">(</a><a id="21152" href="plfa.part3.Soundness.html#21002" class="Bound">Î´</a> <a id="21154" href="plfa.part3.Denotational.html#7364" class="Function Operator">`,</a> <a id="21157" href="plfa.part3.Soundness.html#21125" class="Bound">w</a><a id="21158" class="Symbol">)</a> <a id="21160" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">âŠ¢</a> <a id="21162" href="plfa.part3.Soundness.html#21014" class="Bound">N</a> <a id="21164" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="21166" href="plfa.part3.Soundness.html#21042" class="Bound">v</a>
<a id="21168" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20972" class="Function">substitution-reflect</a> <a id="21189" href="plfa.part3.Soundness.html#21189" class="Bound">d</a> <a id="21191" class="Keyword">with</a> <a id="21196" href="plfa.part3.Soundness.html#15636" class="Function">subst-reflect</a> <a id="21210" href="plfa.part3.Soundness.html#21189" class="Bound">d</a> <a id="21212" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a>
<a id="21217" class="Symbol">...</a>  <a id="21222" class="Symbol">|</a> <a id="21224" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21226" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21226" class="Bound">Î³</a> <a id="21228" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21230" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21232" href="plfa.part3.Soundness.html#21232" class="Bound">Î´ÏƒÎ³</a> <a id="21236" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21238" href="plfa.part3.Soundness.html#21238" class="Bound">Î³Nv</a> <a id="21242" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="21244" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="21246" class="Keyword">with</a> <a id="21251" href="plfa.part3.Soundness.html#20145" class="Function">subst-zero-reflect</a> <a id="21270" href="plfa.part3.Soundness.html#21232" class="Bound">Î´ÏƒÎ³</a>
<a id="21274" class="Symbol">...</a>    <a id="21281" class="Symbol">|</a> <a id="21283" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21285" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21285" class="Bound">w</a> <a id="21287" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21289" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21291" href="plfa.part3.Soundness.html#21291" class="Bound">ineq</a> <a id="21296" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21298" href="plfa.part3.Soundness.html#21298" class="Bound">Î´Mw</a> <a id="21302" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="21304" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="21306" class="Symbol">=</a> <a id="21308" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21310" href="plfa.part3.Soundness.html#21285" class="Bound">w</a> <a id="21312" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21314" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21316" href="plfa.part3.Soundness.html#21298" class="Bound">Î´Mw</a> <a id="21320" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21322" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#25866" class="Function">âŠ‘-env</a> <a id="21328" class="Bound">Î³Nv</a> <a id="21332" href="plfa.part3.Soundness.html#21291" class="Bound">ineq</a> <a id="21337" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="21339" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
</pre>{% endraw %}
We apply the `subst-reflect` lemma to obtain
`Î´ âŠ¢ subst-zero M â†“ Î³` and `Î³ âŠ¢ N â†“ v` for some `Î³`.
Using the former, the `subst-zero-reflect` lemma gives
us `Î³ âŠ‘ (Î´ , w)` and `Î´ âŠ¢ M â†“ w`. We conclude that
`Î´ , w âŠ¢ N â†“ v` by applying the `âŠ‘-env` lemma, using
`Î³ âŠ¢ N â†“ v` and `Î³ âŠ‘ (Î´ , w)`.


### Reduction reflects denotations

Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.

{% raw %}<pre class="Agda"><a id="reflect-beta"></a><a id="21786" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21786" class="Function">reflect-beta</a> <a id="21799" class="Symbol">:</a> <a id="21801" class="Symbol">âˆ€{</a><a id="21803" href="plfa.part3.Soundness.html#21803" class="Bound">Î“</a><a id="21804" class="Symbol">}{</a><a id="21806" href="plfa.part3.Soundness.html#21806" class="Bound">Î³</a> <a id="21808" class="Symbol">:</a> <a id="21810" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="21814" href="plfa.part3.Soundness.html#21803" class="Bound">Î“</a><a id="21815" class="Symbol">}{</a><a id="21817" href="plfa.part3.Soundness.html#21817" class="Bound">M</a> <a id="21819" href="plfa.part3.Soundness.html#21819" class="Bound">N</a><a id="21820" class="Symbol">}{</a><a id="21822" href="plfa.part3.Soundness.html#21822" class="Bound">v</a><a id="21823" class="Symbol">}</a>
    <a id="21829" class="Symbol">â†’</a> <a id="21831" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21806" class="Bound">Î³</a> <a id="21833" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="21835" class="Symbol">(</a><a id="21836" href="plfa.part3.Soundness.html#21819" class="Bound">N</a> <a id="21838" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#7477" class="Function Operator">[</a> <a id="21840" href="plfa.part3.Soundness.html#21817" class="Bound">M</a> <a id="21842" href="plfa.part2.Untyped.html#7477" class="Function Operator">]</a><a id="21843" class="Symbol">)</a> <a id="21845" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="21847" href="plfa.part3.Soundness.html#21822" class="Bound">v</a>
    <a id="21853" class="Symbol">â†’</a> <a id="21855" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21806" class="Bound">Î³</a> <a id="21857" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="21859" class="Symbol">(</a><a id="21860" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="21862" href="plfa.part3.Soundness.html#21819" class="Bound">N</a><a id="21863" class="Symbol">)</a> <a id="21865" href="plfa.part2.Untyped.html#4428" class="InductiveConstructor Operator">Â·</a> <a id="21867" href="plfa.part3.Soundness.html#21817" class="Bound">M</a> <a id="21869" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="21871" href="plfa.part3.Soundness.html#21822" class="Bound">v</a>
<a id="21873" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21786" class="Function">reflect-beta</a> <a id="21886" href="plfa.part3.Soundness.html#21886" class="Bound">d</a>
    <a id="21892" class="Keyword">with</a> <a id="21897" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#20972" class="Function">substitution-reflect</a> <a id="21918" href="plfa.part3.Soundness.html#21886" class="Bound">d</a>
<a id="21920" class="Symbol">...</a> <a id="21924" class="Symbol">|</a> <a id="21926" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21928" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21928" class="Bound">vâ‚‚â€²</a> <a id="21932" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21934" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="21936" href="plfa.part3.Soundness.html#21936" class="Bound">dâ‚â€²</a> <a id="21940" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="21942" href="plfa.part3.Soundness.html#21942" class="Bound">dâ‚‚â€²</a> <a id="21946" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="21948" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a> <a id="21950" class="Symbol">=</a> <a id="21952" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="21959" class="Symbol">(</a><a id="21960" href="plfa.part3.Denotational.html#9668" class="InductiveConstructor">â†¦-intro</a> <a id="21968" href="plfa.part3.Soundness.html#21942" class="Bound">dâ‚‚â€²</a><a id="21971" class="Symbol">)</a> <a id="21973" href="plfa.part3.Soundness.html#21936" class="Bound">dâ‚â€²</a>


<a id="reflect"></a><a id="21979" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="21987" class="Symbol">:</a> <a id="21989" class="Symbol">âˆ€</a> <a id="21991" class="Symbol">{</a><a id="21992" href="plfa.part3.Soundness.html#21992" class="Bound">Î“</a><a id="21993" class="Symbol">}</a> <a id="21995" class="Symbol">{</a><a id="21996" href="plfa.part3.Soundness.html#21996" class="Bound">Î³</a> <a id="21998" class="Symbol">:</a> <a id="22000" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#7207" class="Function">Env</a> <a id="22004" href="plfa.part3.Soundness.html#21992" class="Bound">Î“</a><a id="22005" class="Symbol">}</a> <a id="22007" class="Symbol">{</a><a id="22008" href="plfa.part3.Soundness.html#22008" class="Bound">M</a> <a id="22010" href="plfa.part3.Soundness.html#22010" class="Bound">Mâ€²</a> <a id="22013" href="plfa.part3.Soundness.html#22013" class="Bound">N</a> <a id="22015" href="plfa.part3.Soundness.html#22015" class="Bound">v</a><a id="22016" class="Symbol">}</a>
  <a id="22020" class="Symbol">â†’</a> <a id="22022" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21996" class="Bound">Î³</a> <a id="22024" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="22026" href="plfa.part3.Soundness.html#22013" class="Bound">N</a> <a id="22028" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="22030" href="plfa.part3.Soundness.html#22015" class="Bound">v</a>  <a id="22033" class="Symbol">â†’</a>  <a id="22036" href="plfa.part3.Soundness.html#22008" class="Bound">M</a> <a id="22038" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10133" class="Datatype Operator">â€”â†’</a> <a id="22041" href="plfa.part3.Soundness.html#22010" class="Bound">Mâ€²</a>  <a id="22045" class="Symbol">â†’</a>   <a id="22049" href="plfa.part3.Soundness.html#22010" class="Bound">Mâ€²</a> <a id="22052" href="Agda.Builtin.Equality.html#125" class="Datatype Operator">â‰¡</a> <a id="22054" href="plfa.part3.Soundness.html#22013" class="Bound">N</a>
    <a id="22060" class="Comment">---------------------------------</a>
  <a id="22096" class="Symbol">â†’</a> <a id="22098" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21996" class="Bound">Î³</a> <a id="22100" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9417" class="Datatype Operator">âŠ¢</a> <a id="22102" href="plfa.part3.Soundness.html#22008" class="Bound">M</a> <a id="22104" href="plfa.part3.Denotational.html#9417" class="Datatype Operator">â†“</a> <a id="22106" href="plfa.part3.Soundness.html#22015" class="Bound">v</a>
<a id="22108" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22116" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="22120" class="Symbol">(</a><a id="22121" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10183" class="InductiveConstructor">Î¾â‚</a> <a id="22124" href="plfa.part3.Soundness.html#22124" class="Bound">r</a><a id="22125" class="Symbol">)</a> <a id="22127" class="Symbol">()</a>
<a id="22130" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22138" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="22142" class="Symbol">(</a><a id="22143" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10273" class="InductiveConstructor">Î¾â‚‚</a> <a id="22146" href="plfa.part3.Soundness.html#22146" class="Bound">r</a><a id="22147" class="Symbol">)</a> <a id="22149" class="Symbol">()</a>
<a id="22152" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a><a id="22159" class="Symbol">{</a><a id="22160" class="Argument">Î³</a> <a id="22162" class="Symbol">=</a> <a id="22164" href="plfa.part3.Soundness.html#22164" class="Bound">Î³</a><a id="22165" class="Symbol">}</a> <a id="22167" class="Symbol">(</a><a id="22168" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a><a id="22171" class="Symbol">{</a><a id="22172" class="Argument">x</a> <a id="22174" class="Symbol">=</a> <a id="22176" href="plfa.part3.Soundness.html#22176" class="Bound">x</a><a id="22177" class="Symbol">})</a> <a id="22180" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10363" class="InductiveConstructor">Î²</a> <a id="22182" href="plfa.part3.Soundness.html#22182" class="Bound">mn</a>
    <a id="22189" class="Keyword">with</a> <a id="22194" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a><a id="22197" class="Symbol">{</a><a id="22198" class="Argument">Î³</a> <a id="22200" class="Symbol">=</a> <a id="22202" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#22164" class="Bound">Î³</a><a id="22203" class="Symbol">}{</a><a id="22205" class="Argument">x</a> <a id="22207" class="Symbol">=</a> <a id="22209" href="plfa.part3.Soundness.html#22176" class="Bound">x</a><a id="22210" class="Symbol">}</a>
<a id="22212" class="Symbol">...</a> <a id="22216" class="Symbol">|</a> <a id="22218" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#22218" class="Bound">dâ€²</a> <a id="22221" class="Keyword">rewrite</a> <a id="22229" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22233" class="Bound">mn</a> <a id="22236" class="Symbol">=</a> <a id="22238" href="plfa.part3.Soundness.html#21786" class="Function">reflect-beta</a> <a id="22251" href="plfa.part3.Soundness.html#22218" class="Bound">dâ€²</a>
<a id="22254" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22262" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9471" class="InductiveConstructor">var</a> <a id="22266" class="Symbol">(</a><a id="22267" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10471" class="InductiveConstructor">Î¶</a> <a id="22269" href="plfa.part3.Soundness.html#22269" class="Bound">r</a><a id="22270" class="Symbol">)</a> <a id="22272" class="Symbol">()</a>
<a id="22275" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22283" class="Symbol">(</a><a id="22284" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="22291" href="plfa.part3.Soundness.html#22291" class="Bound">dâ‚</a> <a id="22294" href="plfa.part3.Soundness.html#22294" class="Bound">dâ‚‚</a><a id="22296" class="Symbol">)</a> <a id="22298" class="Symbol">(</a><a id="22299" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10183" class="InductiveConstructor">Î¾â‚</a> <a id="22302" href="plfa.part3.Soundness.html#22302" class="Bound">r</a><a id="22303" class="Symbol">)</a> <a id="22305" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22310" class="Symbol">=</a> <a id="22312" href="plfa.part3.Denotational.html#9546" class="InductiveConstructor">â†¦-elim</a> <a id="22319" class="Symbol">(</a><a id="22320" href="plfa.part3.Soundness.html#21979" class="Function">reflect</a> <a id="22328" href="plfa.part3.Soundness.html#22291" class="Bound">dâ‚</a> <a id="22331" href="plfa.part3.Soundness.html#22302" class="Bound">r</a> <a id="22333" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22337" class="Symbol">)</a> <a id="22339" href="plfa.part3.Soundness.html#22294" class="Bound">dâ‚‚</a>
<a id="22342" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22350" class="Symbol">(</a><a id="22351" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="22358" href="plfa.part3.Soundness.html#22358" class="Bound">dâ‚</a> <a id="22361" href="plfa.part3.Soundness.html#22361" class="Bound">dâ‚‚</a><a id="22363" class="Symbol">)</a> <a id="22365" class="Symbol">(</a><a id="22366" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10273" class="InductiveConstructor">Î¾â‚‚</a> <a id="22369" href="plfa.part3.Soundness.html#22369" class="Bound">r</a><a id="22370" class="Symbol">)</a> <a id="22372" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22377" class="Symbol">=</a> <a id="22379" href="plfa.part3.Denotational.html#9546" class="InductiveConstructor">â†¦-elim</a> <a id="22386" href="plfa.part3.Soundness.html#22358" class="Bound">dâ‚</a> <a id="22389" class="Symbol">(</a><a id="22390" href="plfa.part3.Soundness.html#21979" class="Function">reflect</a> <a id="22398" href="plfa.part3.Soundness.html#22361" class="Bound">dâ‚‚</a> <a id="22401" href="plfa.part3.Soundness.html#22369" class="Bound">r</a> <a id="22403" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22407" class="Symbol">)</a>
<a id="22409" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22417" class="Symbol">(</a><a id="22418" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="22425" href="plfa.part3.Soundness.html#22425" class="Bound">dâ‚</a> <a id="22428" href="plfa.part3.Soundness.html#22428" class="Bound">dâ‚‚</a><a id="22430" class="Symbol">)</a> <a id="22432" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10363" class="InductiveConstructor">Î²</a> <a id="22434" href="plfa.part3.Soundness.html#22434" class="Bound">mn</a>
    <a id="22441" class="Keyword">with</a> <a id="22446" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="22453" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#22425" class="Bound">dâ‚</a> <a id="22456" href="plfa.part3.Soundness.html#22428" class="Bound">dâ‚‚</a>
<a id="22459" class="Symbol">...</a> <a id="22463" class="Symbol">|</a> <a id="22465" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#22465" class="Bound">dâ€²</a> <a id="22468" class="Keyword">rewrite</a> <a id="22476" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22480" class="Bound">mn</a> <a id="22483" class="Symbol">=</a> <a id="22485" href="plfa.part3.Soundness.html#21786" class="Function">reflect-beta</a> <a id="22498" href="plfa.part3.Soundness.html#22465" class="Bound">dâ€²</a>
<a id="22501" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22509" class="Symbol">(</a><a id="22510" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9546" class="InductiveConstructor">â†¦-elim</a> <a id="22517" href="plfa.part3.Soundness.html#22517" class="Bound">dâ‚</a> <a id="22520" href="plfa.part3.Soundness.html#22520" class="Bound">dâ‚‚</a><a id="22522" class="Symbol">)</a> <a id="22524" class="Symbol">(</a><a id="22525" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10471" class="InductiveConstructor">Î¶</a> <a id="22527" href="plfa.part3.Soundness.html#22527" class="Bound">r</a><a id="22528" class="Symbol">)</a> <a id="22530" class="Symbol">()</a>
<a id="22533" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22541" class="Symbol">(</a><a id="22542" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="22550" href="plfa.part3.Soundness.html#22550" class="Bound">d</a><a id="22551" class="Symbol">)</a> <a id="22553" class="Symbol">(</a><a id="22554" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10183" class="InductiveConstructor">Î¾â‚</a> <a id="22557" href="plfa.part3.Soundness.html#22557" class="Bound">r</a><a id="22558" class="Symbol">)</a> <a id="22560" class="Symbol">()</a>
<a id="22563" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22571" class="Symbol">(</a><a id="22572" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="22580" href="plfa.part3.Soundness.html#22580" class="Bound">d</a><a id="22581" class="Symbol">)</a> <a id="22583" class="Symbol">(</a><a id="22584" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10273" class="InductiveConstructor">Î¾â‚‚</a> <a id="22587" href="plfa.part3.Soundness.html#22587" class="Bound">r</a><a id="22588" class="Symbol">)</a> <a id="22590" class="Symbol">()</a>
<a id="22593" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22601" class="Symbol">(</a><a id="22602" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="22610" href="plfa.part3.Soundness.html#22610" class="Bound">d</a><a id="22611" class="Symbol">)</a> <a id="22613" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10363" class="InductiveConstructor">Î²</a> <a id="22615" href="plfa.part3.Soundness.html#22615" class="Bound">mn</a>
    <a id="22622" class="Keyword">with</a> <a id="22627" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="22635" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#22610" class="Bound">d</a>
<a id="22637" class="Symbol">...</a> <a id="22641" class="Symbol">|</a> <a id="22643" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#22643" class="Bound">dâ€²</a> <a id="22646" class="Keyword">rewrite</a> <a id="22654" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22658" class="Bound">mn</a> <a id="22661" class="Symbol">=</a> <a id="22663" href="plfa.part3.Soundness.html#21786" class="Function">reflect-beta</a> <a id="22676" href="plfa.part3.Soundness.html#22643" class="Bound">dâ€²</a>
<a id="22679" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22687" class="Symbol">(</a><a id="22688" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9668" class="InductiveConstructor">â†¦-intro</a> <a id="22696" href="plfa.part3.Soundness.html#22696" class="Bound">d</a><a id="22697" class="Symbol">)</a> <a id="22699" class="Symbol">(</a><a id="22700" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10471" class="InductiveConstructor">Î¶</a> <a id="22702" href="plfa.part3.Soundness.html#22702" class="Bound">r</a><a id="22703" class="Symbol">)</a> <a id="22705" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a> <a id="22710" class="Symbol">=</a> <a id="22712" href="plfa.part3.Denotational.html#9668" class="InductiveConstructor">â†¦-intro</a> <a id="22720" class="Symbol">(</a><a id="22721" href="plfa.part3.Soundness.html#21979" class="Function">reflect</a> <a id="22729" href="plfa.part3.Soundness.html#22696" class="Bound">d</a> <a id="22731" href="plfa.part3.Soundness.html#22702" class="Bound">r</a> <a id="22733" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22737" class="Symbol">)</a>
<a id="22739" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22747" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9780" class="InductiveConstructor">âŠ¥-intro</a> <a id="22755" href="plfa.part3.Soundness.html#22755" class="Bound">r</a> <a id="22757" href="plfa.part3.Soundness.html#22757" class="Bound">mn</a> <a id="22760" class="Symbol">=</a> <a id="22762" href="plfa.part3.Denotational.html#9780" class="InductiveConstructor">âŠ¥-intro</a>
<a id="22770" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22778" class="Symbol">(</a><a id="22779" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="22787" href="plfa.part3.Soundness.html#22787" class="Bound">dâ‚</a> <a id="22790" href="plfa.part3.Soundness.html#22790" class="Bound">dâ‚‚</a><a id="22792" class="Symbol">)</a> <a id="22794" href="plfa.part3.Soundness.html#22794" class="Bound">r</a> <a id="22796" href="plfa.part3.Soundness.html#22796" class="Bound">mn</a> <a id="22799" class="Keyword">rewrite</a> <a id="22807" href="https://agda.github.io/agda-stdlib/v1.1/Relation.Binary.PropositionalEquality.Core.html#939" class="Function">sym</a> <a id="22811" href="plfa.part3.Soundness.html#22796" class="Bound">mn</a> <a id="22814" class="Symbol">=</a>
   <a id="22819" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9847" class="InductiveConstructor">âŠ”-intro</a> <a id="22827" class="Symbol">(</a><a id="22828" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22836" href="plfa.part3.Soundness.html#22787" class="Bound">dâ‚</a> <a id="22839" href="plfa.part3.Soundness.html#22794" class="Bound">r</a> <a id="22841" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22845" class="Symbol">)</a> <a id="22847" class="Symbol">(</a><a id="22848" href="plfa.part3.Soundness.html#21979" class="Function">reflect</a> <a id="22856" href="plfa.part3.Soundness.html#22790" class="Bound">dâ‚‚</a> <a id="22859" href="plfa.part3.Soundness.html#22794" class="Bound">r</a> <a id="22861" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="22865" class="Symbol">)</a>
<a id="22867" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#21979" class="Function">reflect</a> <a id="22875" class="Symbol">(</a><a id="22876" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#9962" class="InductiveConstructor">sub</a> <a id="22880" href="plfa.part3.Soundness.html#22880" class="Bound">d</a> <a id="22882" href="plfa.part3.Soundness.html#22882" class="Bound">lt</a><a id="22884" class="Symbol">)</a> <a id="22886" href="plfa.part3.Soundness.html#22886" class="Bound">r</a> <a id="22888" href="plfa.part3.Soundness.html#22888" class="Bound">mn</a> <a id="22891" class="Symbol">=</a> <a id="22893" href="plfa.part3.Denotational.html#9962" class="InductiveConstructor">sub</a> <a id="22897" class="Symbol">(</a><a id="22898" href="plfa.part3.Soundness.html#21979" class="Function">reflect</a> <a id="22906" href="plfa.part3.Soundness.html#22880" class="Bound">d</a> <a id="22908" href="plfa.part3.Soundness.html#22886" class="Bound">r</a> <a id="22910" href="plfa.part3.Soundness.html#22888" class="Bound">mn</a><a id="22912" class="Symbol">)</a> <a id="22914" href="plfa.part3.Soundness.html#22882" class="Bound">lt</a>
</pre>{% endraw %}
## Reduction implies denotational equality

We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.

{% raw %}<pre class="Agda"><a id="reduce-equal"></a><a id="23089" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23089" class="Function">reduce-equal</a> <a id="23102" class="Symbol">:</a> <a id="23104" class="Symbol">âˆ€</a> <a id="23106" class="Symbol">{</a><a id="23107" href="plfa.part3.Soundness.html#23107" class="Bound">Î“</a><a id="23108" class="Symbol">}</a> <a id="23110" class="Symbol">{</a><a id="23111" href="plfa.part3.Soundness.html#23111" class="Bound">M</a> <a id="23113" class="Symbol">:</a> <a id="23115" href="plfa.part3.Soundness.html#23107" class="Bound">Î“</a> <a id="23117" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4280" class="Datatype Operator">âŠ¢</a> <a id="23119" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="23120" class="Symbol">}</a> <a id="23122" class="Symbol">{</a><a id="23123" href="plfa.part3.Soundness.html#23123" class="Bound">N</a> <a id="23125" class="Symbol">:</a> <a id="23127" href="plfa.part3.Soundness.html#23107" class="Bound">Î“</a> <a id="23129" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="23131" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="23132" class="Symbol">}</a>
  <a id="23136" class="Symbol">â†’</a> <a id="23138" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23111" class="Bound">M</a> <a id="23140" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#10133" class="Datatype Operator">â€”â†’</a> <a id="23143" href="plfa.part3.Soundness.html#23123" class="Bound">N</a>
    <a id="23149" class="Comment">---------</a>
  <a id="23161" class="Symbol">â†’</a> <a id="23163" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#17516" class="Function">â„°</a> <a id="23165" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23111" class="Bound">M</a> <a id="23167" href="plfa.part3.Denotational.html#17698" class="Function Operator">â‰ƒ</a> <a id="23169" href="plfa.part3.Denotational.html#17516" class="Function">â„°</a> <a id="23171" href="plfa.part3.Soundness.html#23123" class="Bound">N</a>
<a id="23173" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23089" class="Function">reduce-equal</a> <a id="23186" class="Symbol">{</a><a id="23187" href="plfa.part3.Soundness.html#23187" class="Bound">Î“</a><a id="23188" class="Symbol">}{</a><a id="23190" href="plfa.part3.Soundness.html#23190" class="Bound">M</a><a id="23191" class="Symbol">}{</a><a id="23193" href="plfa.part3.Soundness.html#23193" class="Bound">N</a><a id="23194" class="Symbol">}</a> <a id="23196" href="plfa.part3.Soundness.html#23196" class="Bound">r</a> <a id="23198" href="plfa.part3.Soundness.html#23198" class="Bound">Î³</a> <a id="23200" href="plfa.part3.Soundness.html#23200" class="Bound">v</a> <a id="23202" class="Symbol">=</a>
    <a id="23208" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="23210" class="Symbol">(Î»</a> <a id="23213" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23213" class="Bound">m</a> <a id="23215" class="Symbol">â†’</a> <a id="23217" href="plfa.part3.Soundness.html#6639" class="Function">preserve</a> <a id="23226" href="plfa.part3.Soundness.html#23213" class="Bound">m</a> <a id="23228" href="plfa.part3.Soundness.html#23196" class="Bound">r</a><a id="23229" class="Symbol">)</a> <a id="23231" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23233" class="Symbol">(Î»</a> <a id="23236" href="plfa.part3.Soundness.html#23236" class="Bound">n</a> <a id="23238" class="Symbol">â†’</a> <a id="23240" href="plfa.part3.Soundness.html#21979" class="Function">reflect</a> <a id="23248" href="plfa.part3.Soundness.html#23236" class="Bound">n</a> <a id="23250" href="plfa.part3.Soundness.html#23196" class="Bound">r</a> <a id="23252" href="Agda.Builtin.Equality.html#182" class="InductiveConstructor">refl</a><a id="23256" class="Symbol">)</a> <a id="23258" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
</pre>{% endraw %}
We conclude with the _soundness property_, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.

{% raw %}<pre class="Agda"><a id="soundness"></a><a id="23423" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23423" class="Function">soundness</a> <a id="23433" class="Symbol">:</a> <a id="23435" class="Symbol">âˆ€{</a><a id="23437" href="plfa.part3.Soundness.html#23437" class="Bound">Î“</a><a id="23438" class="Symbol">}</a> <a id="23440" class="Symbol">{</a><a id="23441" href="plfa.part3.Soundness.html#23441" class="Bound">M</a> <a id="23443" class="Symbol">:</a> <a id="23445" href="plfa.part3.Soundness.html#23437" class="Bound">Î“</a> <a id="23447" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4280" class="Datatype Operator">âŠ¢</a> <a id="23449" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="23450" class="Symbol">}</a> <a id="23452" class="Symbol">{</a><a id="23453" href="plfa.part3.Soundness.html#23453" class="Bound">N</a> <a id="23455" class="Symbol">:</a> <a id="23457" href="plfa.part3.Soundness.html#23437" class="Bound">Î“</a> <a id="23459" href="plfa.part2.Untyped.html#3185" class="InductiveConstructor Operator">,</a> <a id="23461" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a> <a id="23463" href="plfa.part2.Untyped.html#4280" class="Datatype Operator">âŠ¢</a> <a id="23465" href="plfa.part2.Untyped.html#2882" class="InductiveConstructor">â˜…</a><a id="23466" class="Symbol">}</a>
  <a id="23470" class="Symbol">â†’</a> <a id="23472" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23441" class="Bound">M</a> <a id="23474" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#11253" class="Datatype Operator">â€”â† </a> <a id="23477" href="plfa.part2.Untyped.html#4368" class="InductiveConstructor Operator">Æ›</a> <a id="23479" href="plfa.part3.Soundness.html#23453" class="Bound">N</a>
    <a id="23485" class="Comment">-----------------</a>
  <a id="23505" class="Symbol">â†’</a> <a id="23507" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#17516" class="Function">â„°</a> <a id="23509" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23441" class="Bound">M</a> <a id="23511" href="plfa.part3.Denotational.html#17698" class="Function Operator">â‰ƒ</a> <a id="23513" href="plfa.part3.Denotational.html#17516" class="Function">â„°</a> <a id="23515" class="Symbol">(</a><a id="23516" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="InductiveConstructor Operator">Æ›</a> <a id="23518" href="plfa.part3.Soundness.html#23453" class="Bound">N</a><a id="23519" class="Symbol">)</a>
<a id="23521" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23423" class="Function">soundness</a> <a id="23531" class="Symbol">(</a><a id="23532" class="DottedPattern Symbol">.(</a><a id="23534" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#4368" class="DottedPattern InductiveConstructor Operator">Æ›</a> <a id="23536" class="DottedPattern Symbol">_)</a> <a id="23539" href="plfa.part2.Untyped.html#11303" class="InductiveConstructor Operator">âˆ</a><a id="23540" class="Symbol">)</a> <a id="23542" href="plfa.part3.Soundness.html#23542" class="Bound">Î³</a> <a id="23544" href="plfa.part3.Soundness.html#23544" class="Bound">v</a> <a id="23546" class="Symbol">=</a> <a id="23548" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ¨</a> <a id="23550" class="Symbol">(Î»</a> <a id="23553" href="plfa.part3.Soundness.html#23553" class="Bound">x</a> <a id="23555" class="Symbol">â†’</a> <a id="23557" href="plfa.part3.Soundness.html#23553" class="Bound">x</a><a id="23558" class="Symbol">)</a> <a id="23560" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="23562" class="Symbol">(Î»</a> <a id="23565" href="plfa.part3.Soundness.html#23565" class="Bound">x</a> <a id="23567" class="Symbol">â†’</a> <a id="23569" href="plfa.part3.Soundness.html#23565" class="Bound">x</a><a id="23570" class="Symbol">)</a> <a id="23572" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">âŸ©</a>
<a id="23574" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23423" class="Function">soundness</a> <a id="23584" class="Symbol">{</a><a id="23585" href="plfa.part3.Soundness.html#23585" class="Bound">Î“</a><a id="23586" class="Symbol">}</a> <a id="23588" class="Symbol">(</a><a id="23589" href="plfa.part3.Soundness.html#23589" class="Bound">L</a> <a id="23591" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part2/Untyped.md %}{% raw %}#11359" class="InductiveConstructor Operator">â€”â†’âŸ¨</a> <a id="23595" href="plfa.part3.Soundness.html#23595" class="Bound">r</a> <a id="23597" href="plfa.part2.Untyped.html#11359" class="InductiveConstructor Operator">âŸ©</a> <a id="23599" href="plfa.part3.Soundness.html#23599" class="Bound">Mâ€”â† N</a><a id="23603" class="Symbol">)</a> <a id="23605" href="plfa.part3.Soundness.html#23605" class="Bound">Î³</a> <a id="23607" href="plfa.part3.Soundness.html#23607" class="Bound">v</a> <a id="23609" class="Symbol">=</a>
   <a id="23614" class="Keyword">let</a> <a id="23618" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23618" class="Bound">ih</a> <a id="23621" class="Symbol">=</a> <a id="23623" href="plfa.part3.Soundness.html#23423" class="Function">soundness</a> <a id="23633" href="plfa.part3.Soundness.html#23599" class="Bound">Mâ€”â† N</a> <a id="23638" class="Keyword">in</a>
   <a id="23644" class="Keyword">let</a> <a id="23648" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23648" class="Bound">e</a> <a id="23650" class="Symbol">=</a> <a id="23652" href="plfa.part3.Soundness.html#23089" class="Function">reduce-equal</a> <a id="23665" href="plfa.part3.Soundness.html#23595" class="Bound">r</a> <a id="23667" class="Keyword">in</a>
   <a id="23673" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Denotational.md %}{% raw %}#18103" class="Function">â‰ƒ-trans</a> <a id="23681" class="Symbol">{</a><a id="23682" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/part3/Soundness.md %}{% raw %}#23585" class="Bound">Î“</a><a id="23683" class="Symbol">}</a> <a id="23685" href="plfa.part3.Soundness.html#23648" class="Bound">e</a> <a id="23687" href="plfa.part3.Soundness.html#23618" class="Bound">ih</a> <a id="23690" href="plfa.part3.Soundness.html#23605" class="Bound">Î³</a> <a id="23692" href="plfa.part3.Soundness.html#23607" class="Bound">v</a>
</pre>{% endraw %}

## Unicode

This chapter uses the following unicode:

    â‰Ÿ  U+225F  QUESTIONED EQUAL TO (\?=)
